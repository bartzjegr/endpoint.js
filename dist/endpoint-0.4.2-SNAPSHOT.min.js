/**
 * endpointjs - v0.4.2-SNAPSHOT
 * Built 2016-12-11
 * Created in collaboration with Booz Allen Hamilton (www.boozallen.com)
 * (C) 2016 Booz Allen Hamilton, All rights reserved
 * Powered by InnoVision, created by the GIAT
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);if(d.super_.call(this,a,{type:j.EndpointType.ADAPTER,id:i(),identification:h("[name: %s] [version: %s]",b.name,b.version)}),this._name=b.name,this._version=""+b.version,this._object=b.object||{},this._resolver=b.resolver||m({instanceId:a.getInstanceId(),id:this.getId()}),this._metadata=b.metadata||{},this._neighborhood=n.getNeighborhood(b.neighborhood,"group"),this._neighborhood===j.Neighborhood.GLOBAL)throw this.close(),new Error("Cannot use GLOBAL neighborhood for adapter. Must use UNIVERSAL");var c="adapter|"+this.getName()+"|"+this.getVersion();if(f.listenerCount(this.getBus(),c)>0)throw this.close(),new Error("That adapter is already registered: "+c);this._maxAdapterInstances=a.getConfiguration().get("maxAdapterInstances"),this._maxHops=a.getConfiguration().get("maxHops"),this._clientInstances={},this._clientInstancesCount=0,this._currentContext=null,this._facadeEvents=null,this.registerBusEvent(c,this._handleRegistryRequest.bind(this)),this.registerDefaultMessengerListener(),o.log(o.DEBUG,"Created %s",this);var e=this.getBus(),g="register|"+this.getName()+"|"+this.getVersion();n.nextTick(function(){o.log(o.DEBUG2,"Sending register event for %s",this),e.emit(j.Neighborhood.LOCAL,g)}.bind(this))}var e=a("../../endpoint/endpoint"),f=a("events").EventEmitter,g=a("util").inherits,h=a("util").format,i=a("uuid"),j=a("../../util/constants"),k=a("../../routing/address"),l=a("./client-instance"),m=a("./resolver"),n=a("../../util/appUtils"),o=n.getLogger(c);g(d,e),b.exports=d,d.prototype.getName=function(){return this._name},d.prototype.getVersion=function(){return this._version},d.prototype.getObject=function(){return this._object},d.prototype.getEvents=function(){if(null===this._facadeEvents){var a=this;this._facadeEvents={emit:function(){for(var b in a._clientInstances)a._clientInstances[b].getEvents().emit.apply(a._clientInstances[b],arguments)}}}return this._facadeEvents},d.prototype.getMetadata=function(){return this._metadata},d.prototype.setMetadata=function(a){this._metadata=a||{}},d.prototype.setCurrentContext=function(a){this._currentContext=a},d.prototype.getCurrentContext=function(){return this._currentContext},d.prototype._handleRegistryRequest=function(a,b,c){if(!(b>this._neighborhood))return o.log(o.TRACE,"Adapter request: %s",this),this._clientInstancesCount>=this._maxAdapterInstances?void o.log(o.WARN,"Max client instance count reached [%s], ignoring adapter request",this._clientInstancesCount):void(this._resolver.resolve(c.criteria,this._metadata,a)&&(o.log(o.DEBUG3,"Responding to adapter request [for: %s]: %s",c.id,this),this.getMessenger().sendMessage(a,c.id,{type:"api",id:this.getId(),address:a.getPathVector()})))},d.prototype._handleMessage=function(a,b){if(!(b>this._neighborhood||this._clientInstancesCount>=this._maxAdapterInstances)){var c=k(a.address),d=!n.isUuid(a.id)||!c.isValid(this._maxHops)||null!==a.hostAffinityId&&!n.isUuid(a.hostAffinityId);if(d)return void o.log(o.WARN,"Invalid adapter request: %j",a);var e=l(this.getEndpointManager(),{remoteAddress:c,remoteId:a.id,hostAffinityId:a.hostAffinityId,neighborhood:this._neighborhood,facadeId:a.facadeId,adapter:this});this._clientInstances[e.getId()]=e,this._clientInstancesCount+=1,e.on("closed",function(){delete this._clientInstances[e.getId()],this._clientInstancesCount-=1}.bind(this)),this.emit("client-instance",e)}},d.prototype._handleClose=function(){if(this._clientInstances){var a=Object.keys(this._clientInstances);for(var b in a)this._clientInstances[b].close()}}}).call(this,"/js\\app\\api\\adapter\\adapter.js")},{"../../endpoint/endpoint":26,"../../routing/address":36,"../../util/appUtils":54,"../../util/constants":55,"./client-instance":2,"./resolver":5,events:65,util:85,uuid:86}],2:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);d.super_.call(this,a,{type:j.EndpointType.CLIENT_INSTANCE,id:i(),identification:g("[name: %s] [version: %s]",b.adapter.getName(),b.adapter.getVersion())}),this.registerDefaultMessengerListener(),this._maxClientObjects=a.getConfiguration().get("maxClientObjects"),this._facadeEvents=null,this._adapter=b.adapter,this._remoteAddress=b.remoteAddress,this._remoteId=b.remoteId,this._hostAffinityId=b.hostAffinityId,this._neighborhood=b.neighborhood,this._remoteConnected=!0,this._objects={},this._totalObjects=0;var c=this.createObjectInstance(this._adapter.getName(),this._adapter.getObject(),b.facadeId);c.attachEndpoint(this),this.getMessenger().sendMessage(this._remoteAddress,this._remoteId,{type:"connect",id:this.getId(),object:c.getApi()}),this.trackEndpointAffinity(this._hostAffinityId),l.log(l.DEBUG,"Created %s",this)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("util").format,h=a("./object-instance"),i=a("uuid"),j=a("../../util/constants"),k=a("../../util/appUtils"),l=k.getLogger(c);f(d,e),b.exports=d,d.prototype.getAdapter=function(){return this._adapter},d.prototype.getObjectInstance=function(a){return this._objects[a]},d.prototype.getRemoteAddress=function(){return this._remoteAddress},d.prototype.getRemoteId=function(){return this._remoteId},d.prototype.getHostAffinityId=function(){return this._hostAffinityId},d.prototype.getEvents=function(){if(null===this._facadeEvents){var a=this;this._facadeEvents={emit:function(){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c]);a.getMessenger().sendMessage(a._remoteAddress,a._remoteId,{type:"event",event:b})}}}return this._facadeEvents},d.prototype.createObjectInstance=function(a,b,c,d){if(this._totalObjects>this._maxClientObjects)return l.log(l.WARN,"Max client objects exceeded [total: %s] for %s",this._maxClientObjects,this),null;var e=h(this.getEndpointManager(),{name:a,object:b,remoteId:c,clientInstance:this});return this._objects[e.getId()]=e,this._totalObjects+=1,e.on("closed",function(){delete this._objects[e.getId()],this._totalObjects-=1}.bind(this)),d=d||this,d.attachEndpoint(e),e},d.prototype._handleMessage=function(a,b){if(!(b>this._neighborhood)){var c=a.type;if(c)switch(c){case"disconnect":return this._remoteConnected=!1,void this.close()}l.log(l.ERROR,"Malformed message: %j for %s",a,this)}},d.prototype._handleClose=function(a){this._remoteConnected&&!a&&this.getMessenger().sendMessage(this._remoteAddress,this._remoteId,{id:this.getId(),type:"disconnect"})}}).call(this,"/js\\app\\api\\adapter\\client-instance.js")},{"../../endpoint/endpoint":26,"../../util/appUtils":54,"../../util/constants":55,"./object-instance":4,util:85,uuid:86}],3:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(this._objectInstance=a,this._inputStream=null,this._outputStream=null,this._cb=null,this._asyncMode=!1,this._buffered=!1,void(this._periodicCounter=0)):new d(a)}var e=a("through2"),f=a("../../util/appUtils"),g=f.getLogger(c);b.exports=d,d.prototype.incrementPeriodic=function(){this._periodicCounter+=1},d.prototype.getPeriodic=function(){return this._periodicCounter},d.prototype.getClientInstance=function(){return this._objectInstance.getClientInstance()},d.prototype.getObjectInstance=function(){return this._objectInstance},d.prototype.isBuffered=function(){return this._buffered},d.prototype.setBuffered=function(a){this._buffered=a},d.prototype.setAsyncMode=function(){this._asyncMode=!0},d.prototype.isAsync=function(){return this._asyncMode},d.prototype.setAsyncResult=function(a){this._cb("result",a)},d.prototype.setAsyncError=function(a){this._cb("error",a)},d.prototype.hasInputStream=function(){return null!==this._inputStream},d.prototype.hasOutputStream=function(){return null!==this._outputStream},d.prototype.getInputStream=function(){return this._inputStream},d.prototype.setInputStream=function(a){this._inputStream=a},d.prototype.getOutputStream=function(){return this._outputStream},d.prototype.setOutputStream=function(a){this._outputStream=a},d.prototype.execute=function(a,b,c){var d=this.getObjectInstance(),e=this.getClientInstance().getAdapter();g.log(g.DEBUG3,"Executing %s on %s",a,d),this._cb=c;var f;try{e.setCurrentContext(this);var h=d.getObject();if(!h[a])throw new Error("Unknown function name");f=h[a].apply(h,b),this.hasInputStream()&&this.hasOutputStream()&&(this.getInputStream().on("end",function(){this.getOutputStream().end()}.bind(this)),this.getOutputStream().on("end",function(){this.getInputStream().end()}.bind(this))),e.setCurrentContext(null),this.isAsync()||c("result",f)}catch(d){e.setCurrentContext(null),g.log(g.WARN,"Issue executing API call [func: %s] [args: %j] [exception: %s] [trace: %s]",a,b,d.toString(),d.stack),c("error",d)}},d.prototype.cancel=function(){this.hasInputStream()&&this.getInputStream().end(),this.hasOutputStream()&&this.getOutputStream().end()},d.prototype.transformDuplexStream=function(a,b){var c=e.obj;this._buffered&&(c=e),this._inputStream.pipe(c(a)).pipe(this._outputStream),this._outputStream.pipe(c(b)).pipe(this._inputStream)},d.prototype.transformStream=function(a){var b=e.obj;this._buffered&&(b=e),this._inputStream.pipe(b(a)).pipe(this._outputStream)}}).call(this,"/js\\app\\api\\adapter\\context.js")},{"../../util/appUtils":54,through2:81}],4:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);var c=b.clientInstance.getAdapter();d.super_.call(this,a,{type:k.EndpointType.OBJECT_INSTANCE,id:h(),identification:g("[name: %s] [version: %s]",b.name,c.getVersion())}),this.registerDefaultStreamerListener(),this.registerDefaultMessengerListener(),this._name=b.name,this._object=b.object,this._clientInstance=b.clientInstance,this._remoteId=b.remoteId,this._contexts={},this._contextsCount=0,this._remoteConnected=!0,this._methodIndex=this._createMethodIndex(),m.log(m.DEBUG,"Created %s",this)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("util").format,h=a("uuid"),i=a("./context"),j=a("../../routing/address"),k=a("../../util/constants"),l=a("../../util/appUtils"),m=l.getLogger(c);f(d,e),b.exports=d,d.prototype.getName=function(){return this._name},d.prototype.getObject=function(){return this._object},d.prototype.getClientInstance=function(){return this._clientInstance},d.prototype.getRemoteAddress=function(){return this.getClientInstance().getRemoteAddress()},d.prototype.getRemoteId=function(){return this._remoteId},d.prototype.getContext=function(a,b){if(this.hasContext(a))return this._contexts[a];if(b){if(!l.isUuid(a))throw new Error("invalid context id");var c=this._contexts[a]=i(this,a);return this._contextsCount+=1,1==this._contextsCount&&this.getEndpointManager().registerPeriodic(this),c}return null},d.prototype.getApi=function(){return{id:this.getId(),methods:this.getMethodNames()}},d.prototype.getMethodNames=function(){return Object.keys(this._methodIndex)},d.prototype.hasContext=function(a){return!!this._contexts[a]},d.prototype._handleStream=function(a,b){var c=a.meta.type,d=a.meta.id;if(this.attachStream(a),d){var e;switch(c){case"input":e=this.getContext(d,!0),e.setInputStream(a),e.setBuffered(!b.objectMode);break;case"output":e=this.getContext(d,!0),e.setOutputStream(a);break;default:return m.log(m.ERROR,"Malformed stream: %j for %s",a.meta,this),void a.end()}this.getMessenger().sendMessage(this.getRemoteAddress(),d,{type:"stream-connected"})}},d.prototype._handleMessage=function(a,b){if(!(b>this._neighborhood)){var c=a.id,d=a.type;if(c&&d)switch(d){case"close":return this._remoteConnected=!1,void this.close();case"remote-stream":return void this._establishRemoteStream(c,a);case"call-facade":case"call-ignore":case"call":return void this._callMethod(c,d,a);case"cancel":return void this.cancel(c)}m.log(m.ERROR,"Malformed message: %j for %s",a,this)}},d.prototype._callMethod=function(a,b,c){var d=this.getContext(a,!0);if(c.xargs&&c.xargs.length>0)for(var e=0;e<c.xargs.length;e++){var f=c.xargs[e],h=c.args[f],i=this.getClientInstance().getObjectInstance(h);i?c.args[f]=i.getObject():m.log(m.WARN,"Unknown object id: %s",h)}var j,k=function(d,e){if(this.removeContext(a),"result"==d){if(j={type:"result"},"call"==b)j.value=e;else if("call-facade"==b){var f=g("%s.%s",this.getName(),c.func),h=this.getClientInstance().createObjectInstance(f,e,c.facadeId,this);h?j.value=h.getApi():j={type:"error",message:"Could not create the object instance",name:"Error"}}}else j={type:"error",message:e.message,name:e.name};this.getMessenger().sendMessage(this.getRemoteAddress(),a,j)}.bind(this);this.hasMethod(c.func)?d.execute(c.func,c.args,k):(m.log(m.ERROR,"Method does not exist: %s for %s",c.func,this),k("error",new Error("Method not found")))},d.prototype._establishRemoteStream=function(a,b){var c=this.getContext(a,!0),d=b.remoteAddress,e=b.remoteId,f=this.getRemoteAddress().routeThrough(j(d,!0)),g=this.getStreamer().createStream(e,f,{id:b.callId,type:"input"},{objectMode:!b.buffered});this.attachStream(g),this.getMessenger().sendMessage(this.getRemoteAddress(),a,{type:"stream-connected"}),c.setOutputStream(g)},d.prototype.hasMethod=function(a){return!!this._methodIndex[a]},d.prototype._createMethodIndex=function(){var a={},b=this._object,c=0;for(var d in b)"function"==typeof b[d]&&"_"!==d.charAt(0)&&(a[d]=!0,c+=1);return m.log(m.DEBUG2,"Counted %s functions in object for %s",c,this),a},d.prototype.performPeriodic=function(){for(var a=Object.keys(this._contexts),b=0;b<a.length;b++){var c=a[b],d=this._contexts[c];d.incrementPeriodic(),d.getPeriodic()>2&&(m.log(m.DEBUG,"Context is stale [ctx: %s] for %s",c,this),this.cancel(c))}},d.prototype.cancel=function(a){this.hasContext(a)&&(this._contexts[a].cancel(),this.removeContext(a))},d.prototype.removeContext=function(a){this.hasContext(a)&&(delete this._contexts[a],this._contextsCount-=1,0===this._contextsCount&&this.getEndpointManager().unregisterPeriodic(this))},d.prototype._handleClose=function(a){this._remoteConnected&&!a&&this.getMessenger().sendMessage(this.getRemoteAddress(),this._remoteId,{id:this.getId(),type:"close"});var b=Object.keys(this._contexts);for(var c in b)this.cancel(c)}}).call(this,"/js\\app\\api\\adapter\\object-instance.js")},{"../../endpoint/endpoint":26,"../../routing/address":36,"../../util/appUtils":54,"../../util/constants":55,"./context":3,util:85,uuid:86}],5:[function(a,b,c){"use strict";function d(a){return this instanceof d?(this._id=a.id,void(this._instanceId=a.instanceId)):new d(a)}b.exports=d,d.prototype.resolve=function(a,b,c){return!a||(!a.hasOwnProperty("instanceId")||a.instanceId===this._instanceId)&&(!a.hasOwnProperty("id")||a.id===this._id)}},{}],6:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(this._id=b.get("instanceId"),this._endpointManager=a,void j.log(j.DEBUG,"API Layer initialized")):new d(a,b)}var e=a("./adapter/adapter"),f=a("./facade/client"),g=a("./facade/query"),h=a("./facade-manager"),i=a("../util/appUtils"),j=i.getLogger(c);b.exports=d,d.prototype.getInstanceId=function(){return this._id},d.prototype.getEndpointManager=function(){return this._endpointManager},d.prototype.getConfiguration=function(){return this._endpointManager.getConfiguration()},d.prototype.createQuery=function(a,b,c){return c=c||{},g(this._endpointManager,{name:a,version:b,criteria:c.criteria||{},neighborhood:c.neighborhood||"local",tryForever:!c.hasOwnProperty("tryForever")||c.tryForever,bridgeId:c.bridgeId,hostId:c.hostId})},d.prototype.createFacade=function(a,b,c){function d(a){e.connect(a.address,a.id,a.neighborhood,g.getId())}c=c||{};var e=f(this._endpointManager,{name:a,version:b}),g=e.createFacadeInstance(a);if(g.attachEndpoint(e,!1),c.api)d(c.api);else{var h=this.createQuery(a,b,c);h.on("api",function(a){h.close(),d(a)}),h.on("timeout",function(){j.log(j.WARN,"A facade timed out for %s",this),g.emit("timeout"),g.close()}),g.attachEndpoint(h)}return g},d.prototype.manageFacades=function(){var a=h(this);try{for(var b=0;b<arguments.length;b++){var c=arguments[b];if(c.length<2)throw a.close(),new Error("Input error, invalid number of arguments for facade manager");h.prototype.addFacade.apply(a,c)}}catch(b){throw j.log(j.ERROR,"Could not create facade manager: %s, stack = %s",b.message,b.stack),a.close(),b}return a},d.prototype.registerAdapter=function(a,b,c,d){return d=d||{},e(this._endpointManager,{name:a,version:b,object:c,neighborhood:d.neighborhood||"group",resolver:d.resolver,metadata:d.metadata||{}})}}).call(this,"/js\\app\\api\\api.js")},{"../util/appUtils":54,"./adapter/adapter":1,"./facade-manager":7,"./facade/client":14,"./facade/query":16}],7:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(e.call(this),this._facades={},this._api=a,this._ready=!1,this._closed=!1,this._totalFacades=0,void(this._facadesReady=0)):new d(a)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype.getFacade=function(a){if(!this._facades[a])throw new Error("Do not know of that facade");return this._facades[a]},d.prototype.getApi=function(a){if(!this._ready)throw new Error("Facade Manager isn't ready");return this.getFacade(a).getApi()},d.prototype.getEvents=function(a){if(!this._ready)throw new Error("Facade Manager isn't ready");return this.getFacade(a).getEvents()},d.prototype.addFacade=function(a,b,c){if(this._facades[a])throw new Error("Can only managed one facade of a specific type");var d=this._api.createFacade(a,b,c);this._totalFacades+=1,this._facades[d.getName()]=d,d.on("closed",function(){h.log(h.DEBUG2,"Facade was closed for %s",d.getId()),delete this._facades[d.getName()],this._totalFacades-=1,d.isReady()&&(this._facadesReady-=1),this._closed||(h.log(h.WARN,"Facade was closed.  Re-creating for %s",d.getId()),this.addFacade(a,b,c))}.bind(this)),d.on("ready",function(){if(this._facadesReady+=1,this._facadesReady===this._totalFacades){var a=!0;this._ready||(a=!1,this._ready=!0),this.emit("reconnect"),a||this.emit("ready")}}.bind(this))},d.prototype.close=function(){this._closed=!0;var a=Object.keys(this._facades);a.forEach(function(a){this._facades[a].close()},this)}}).call(this,"/js\\app\\api\\facade-manager.js")},{"../util/appUtils":54,events:65,util:85}],8:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(d.super_.call(this,a,{type:h.EndpointType.CALL,id:g()}),this.getEndpointManager().registerPeriodic(this),this._readyToExecute=!1,this._forwardStream=null,this._reverseStream=null,this._buffered=!1,this._result=null,void(this._periodicCounter=0)):new d(a,b)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("uuid"),h=a("../../util/constants"),i=a("../../util/appUtils"),j=i.getLogger(c);f(d,e),b.exports=d,d.prototype.performPeriodic=function(){this._periodicCounter++,6==this._periodicCounter&&(j.log(j.WARN,"A call timed out for %s",this),this.emit("call-error","Call timed out"))},d.prototype.isFacadeCall=function(){return!1},d.prototype.isStreamCall=function(){return!1},d.prototype.isCallbackCall=function(){return!1},d.prototype.connectForwardStream=function(a){this._forwardStream=a},d.prototype.getForwardStream=function(){return this._forwardStream},d.prototype.connectReverseStream=function(a){this._reverseStream=a},d.prototype.getReverseStream=function(){return this._reverseStream},d.prototype.isBuffered=function(){return this._buffered},d.prototype.setBuffered=function(a){this._buffered=a},d.prototype.setResult=function(a){this._result=a},d.prototype.getResult=function(){return this._result},d.prototype.pipe=function(a){if(a.setBuffered(this.isBuffered()),a.isFacadeCall()){var b=a.establishInputStream(this.isBuffered());a.connectForwardStream(b),a.connectReverseStream(b),this.getForwardStream().pipe(b),b.pipe(this.getReverseStream())}else if(a.isStreamCall()||a.isCallbackCall()&&a.wantsStreams())a.connectForwardStream(this.getForwardStream()),a.connectReverseStream(this.getReverseStream());else if(!a.isCallbackCall())throw new Error("Unknown call type")},d.prototype.execute=function(){j.log(j.DEBUG2,"Complete for %s",this),this.emit("complete")}}).call(this,"/js\\app\\api\\facade\\call.js")},{"../../endpoint/endpoint":26,"../../util/appUtils":54,"../../util/constants":55,util:85,uuid:86}],9:[function(a,b,c){"use strict";function d(a,b){return this instanceof d?void e.call(this,a,b):new d(a,b)}var e=a("./facade-call"),f=a("util").inherits;f(d,e),b.exports=d,d.prototype.isBaseCall=function(){return!0},d.prototype.connectInputStream=function(){var a=this.establishInputStream(this.isBuffered());return this.connectForwardStream(a),this.connectReverseStream(a),a},d.prototype._setResultValue=function(a){this.setResult(a)}},{"./facade-call":11,util:85}],10:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this,a,b),this._func=b.func,void(this._wantsStreams=b.func.length>1)):new d(a,b)}var e=a("../call"),f=a("util").inherits,g=a("../../../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype.getFunc=function(){return this._func},d.prototype.wantsStreams=function(){return this._wantsStreams},d.prototype.isCallbackCall=function(){return!0},d.prototype.execute=function(){try{var a=this._func(this.getResult(),this.getForwardStream(),this.getReverseStream());this.setResult(a),h.log(h.DEBUG2,"Complete for callback %s",this),this.emit("complete")}catch(a){h.log(h.WARN,"Issue executing Callback call [exception: %s] [trace: %s]",a.toString(),a.stack),this.emit("call-error",a.message)}}}).call(this,"/js\\app\\api\\facade\\calls\\callback-call.js")},{"../../../util/appUtils":54,"../call":8,util:85}],11:[function(a,b,c){(function(c){"use strict";function d(b,c){return this instanceof d?(e||(e=a("../facade")),f.call(this,b,c),this.registerDefaultMessengerListener(),this._pendingStreamsCount=0,this._func=c.func,this._args=c.args,this._facade=this._func.getFacade(),this._complete=!1,this._executing=!1,this._returnResult=!1,this._returnFacade=!1,void(this._facadeResult=null)):new d(b,c)}var e,f=a("../call"),g=a("util").inherits,h=a("util").format,i=a("../../../util/appUtils"),j=i.getLogger(c);g(d,f),b.exports=d,d.prototype.getFunction=function(){return this._func},d.prototype.getArguments=function(){return this._args},d.prototype.isFacadeCall=function(){return!0},d.prototype.isBaseCall=function(){return!1},d.prototype.setReturnFacade=function(a){this._returnFacade=a},d.prototype.setReturnResult=function(a){this._returnResult=a},d.prototype.establishRemoteStream=function(a,b,c,d){this._pendingStreamsCount+=1,this._sendMessage({type:"remote-stream",callId:a,remoteAddress:b.getPathVector(),remoteId:c,buffered:d})},d.prototype.incrementExpectedStreamCount=function(){this._pendingStreamsCount+=1},d.prototype.getRemoteAddress=function(){return this._facade.getRemoteAddress()},d.prototype.getRemoteId=function(){return this._facade.getRemoteId()},d.prototype.establishInputStream=function(a){this._pendingStreamsCount+=1;var b=this.establishStream("input",a);return this._facade.attachStream(b),b},d.prototype.establishOutputStream=function(a){this._pendingStreamsCount+=1;var b=this.establishStream("output",a);return this._facade.attachStream(b),b},d.prototype._handleMessage=function(a){switch(a.type){case"stream-connected":j.log(j.TRACE,"Received stream connected message for %s",this),this._pendingStreamsCount-=1,0===this._pendingStreamsCount&&this._readyToExecute&&this.execute();break;case"result":this._complete=!0,this._handleResult(a);break;case"error":this._complete=!0,j.log(j.ERROR,"Error [%s] type [%s] for call %s",a.message,a.name,this),this.emit("call-error",a.message,a.name);break;default:j.log(j.WARN,"Unknown message: %j for %s",a,this)}},d.prototype._handleResult=function(a){if(this._returnFacade){try{this._facadeResult.assignObject(a.value)}catch(a){return j.log(j.ERROR,"Object Error [%s] for call %s",a.message,this),void this.emit("call-error",a.message,"facade-object")}a.value=this._facadeResult,this._facadeResult=null}this._setResultValue(a.value),j.log(j.DEBUG2,"Call complete for %s",this),this.emit("complete")},d.prototype._setResultValue=function(a){},d.prototype.establishStream=function(a,b){var c=this.getStreamer().createStream(this.getRemoteId(),this.getRemoteAddress(),{id:this.getId(),type:a},{objectMode:!b});return c},d.prototype.pipe=function(a){if(a.setBuffered(this.isBuffered()),a.isFacadeCall())a.incrementExpectedStreamCount(),this.establishRemoteStream(a.getId(),a.getRemoteAddress(),a.getRemoteId(),this.isBuffered());else if(a.isStreamCall()||a.isCallbackCall()&&a.wantsStreams()){var b=this.establishOutputStream(this.isBuffered());a.connectForwardStream(b),a.connectReverseStream(b)}else if(!a.isCallbackCall())throw new Error("Unknown call type")},d.prototype.execute=function(){if(this._pendingStreamsCount>0)this._readyToExecute=!0;else{for(var a=[],b=[],c=0;c<this._args.length;c++){var d=this._args[c];d instanceof e?(a.push(c),b.push(d.getRemoteId())):d._facade&&d._facade instanceof e?(a.push(c),b.push(d._facade.getRemoteId())):b.push(this._args[c])}j.log(j.DEBUG2,"Sent call for %s",this),this._executing=!0;var f={type:"call",func:this._func.getFacadeFunctionName(),args:b,xargs:a};if(this._returnResult){if(this._returnFacade){var g=h("%s.%s",this._facade.getName(),f.func);this._facadeResult=this._facade.getClient().createFacadeInstance(g,this._facade),f.type="call-facade",f.facadeId=this._facadeResult.getId()}}else f.type="call-ignore";this._sendMessage(f)}},d.prototype._sendMessage=function(a){a.id=this.getId(),this.getMessenger().sendMessage(this.getRemoteAddress(),this.getRemoteId(),a)},d.prototype._handleClose=function(){!this._complete&&this._executing&&this._sendMessage({type:"cancel"}),this._facadeResult&&this._facadeResult.close()}}).call(this,"/js\\app\\api\\facade\\calls\\facade-call.js")},{"../../../util/appUtils":54,"../call":8,"../facade":15,util:85}],12:[function(a,b,c){"use strict";function d(a,b){return this instanceof d?(e.call(this,a,b),this._forwardStream=b.forwardStream||g.obj(),void(this._reverseStream=b.reverseStream||g.obj())):new d(a,b)}var e=a("../call"),f=a("util").inherits,g=a("through2");f(d,e),b.exports=d,d.prototype.isStreamCall=function(){return!0},d.prototype.setForwardStream=function(a){this._forwardStream=a},d.prototype.setReverseStream=function(a){this._reverseStream=a},d.prototype.connectForwardStream=function(a){a.pipe(this._forwardStream),e.prototype.connectForwardStream.call(this,this._forwardStream)},d.prototype.connectReverseStream=function(a){this._reverseStream.pipe(a),e.prototype.connectReverseStream.call(this,this._reverseStream)}},{"../call":8,through2:81,util:85}],13:[function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);e.call(this,a,b),this._inputFunc=b.inputFunc,this._outputFunc=null,b.hasOwnProperty("outputFunc")&&(this._outputFunc=b.outputFunc);var c=this._setupTransform(this._inputFunc);this.setForwardStream(c),null!==this._outputFunc&&(c=this._setupTransform(this._outputFunc),this.setReverseStream(c))}var e=a("./stream-call"),f=a("util").inherits,g=a("through2");f(d,e),b.exports=d,d.prototype._setupTransform=function(a){return this.isBuffered()?g(a):g.obj(a)}},{"./stream-call":12,through2:81,util:85}],14:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(d.super_.call(this,a,{type:k.EndpointType.CLIENT,id:i(),identification:j("[name: %s] [version: %s]",b.name,b.version)}),this.registerDefaultMessengerListener(),this._eventEmitter=new h,this._name=b.name,this._version=b.version,this._remoteConnected=!1,this._facades={},this._remoteAddress=null,this._remoteId=null,this._hostAffinityId=null,this._neighborhood=0,this._facadeId=null,void m.log(m.DEBUG,"Created %s",this)):new d(a,b)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("./facade"),h=a("events").EventEmitter,i=a("uuid"),j=a("util").format,k=a("../../util/constants"),l=a("../../util/appUtils"),m=l.getLogger(c);f(d,e),b.exports=d,d.prototype.getName=function(){return this._name},d.prototype.getVersion=function(){return this._version},d.prototype.getRemoteAddress=function(){return this._remoteAddress},d.prototype.getNeighborhood=function(){return this._neighborhood},d.prototype.getRemoteId=function(){return this._remoteId},d.prototype.getHostAffinityId=function(){return this._hostAffinityId},d.prototype.getEvents=function(){return this._eventEmitter},d.prototype.connect=function(a,b,c,d){this._remoteAddress=a,this._neighborhood=c,this._facadeId=d,this._hostAffinityId=this.getHostAffinity().establishHostAffinity(a),this.trackEndpointAffinity(this._hostAffinityId),this.getMessenger().sendMessage(a,b,{id:this.getId(),address:a.getPathVector(),hostAffinityId:this._hostAffinityId,facadeId:d})},d.prototype._handleMessage=function(a,b){if(!(b>this._neighborhood))switch(a.type){case"connect":l.isUuid(a.id)&&(this._remoteConnected=!0,this._handleConnection(a));break;case"disconnect":this._remoteConnected=!1,this.close();break;case"event":this._eventEmitter.emit.apply(this._eventEmitter,a.event)}},d.prototype._handleConnection=function(a){this._remoteId=a.id;var b=a.object,c=this._facades[this._facadeId];if(!c){var d="Could not locate facade to assign API to for ";throw m.log(m.ERROR,d+this),new Error(d+this)}c.assignObject(b),this.emit("ready")},d.prototype.createFacadeInstance=function(a,b){var c=g(this.getEndpointManager(),{name:a,version:this.getVersion(),client:this});return this._facades[c.getId()]=c,c.on("closed",function(){delete this._facades[c.getId()]}.bind(this)),b=b||this,b.attachEndpoint(c),c},d.prototype._handleClose=function(a){this._remoteConnected&&!a&&this.getMessenger().sendMessage(this._remoteAddress,this._remoteId,{id:this.getId(),type:"disconnect"}),this._remoteAddress&&this.getHostAffinity().removeHostAffinity(this._remoteAddress,this._hostAffinityId)}}).call(this,"/js\\app\\api\\facade\\client.js")},{"../../endpoint/endpoint":26,"../../util/appUtils":54,"../../util/constants":55,"./facade":15,events:65,util:85,uuid:86}],15:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(d.super_.call(this,a,{type:k.EndpointType.FACADE,id:h(),identification:i("[name: %s] [version: %s]",b.name,b.client.getVersion())}),this.registerDefaultMessengerListener(),this._strategies={},this._name=b.name,this._client=b.client,this._remoteConnected=!1,this._api=null,this._remoteId=null,this._ready=!1,void m.log(m.DEBUG,"Created %s",this)):new d(a,b)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("util").isArray,h=a("uuid"),i=a("util").format,j=a("./strategy"),k=a("../../util/constants"),l=a("../../util/appUtils"),m=l.getLogger(c);f(d,e),b.exports=d,d.prototype.getName=function(){return this._name},d.prototype.getVersion=function(){return this.getClient().getVersion()},d.prototype.getClient=function(){return this._client},d.prototype.getEvents=function(){return this.getClient().getEvents()},d.prototype.getRemoteAddress=function(){return this.getClient().getRemoteAddress()},d.prototype.getRemoteId=function(){return this._remoteId},d.prototype.isReady=function(){return this._ready},d.prototype.assignObject=function(a){if(!a||!g(a.methods)||!l.isUuid(a.id))throw this.close(),new Error("Invalid API response for Facade "+this);if(null===this._api){this._remoteConnected=!0,this._remoteId=a.id,m.log(m.DEBUG,"Assigning API [id = %s] for %s",this._remoteId,this);var b=this,c=this._api={};a.methods.forEach(function(a){c[a]=function(){var d=j(b.getEndpointManager());return d.call(c[a],arguments),b._strategies[d.getId()]=d,d.on("complete",function(){delete b._strategies[d.getId()]}),l.nextTick(function(){d.execute();
}),d},c[a].isFacadeFunction=function(){return!0},c[a].getFacadeFunctionName=function(){return a},c[a].getFacade=function(){return b}}),c._facade=this,this._ready=!0,this.emit("ready")}else m.log(m.DEBUG,"Already established API for %s",this)},d.prototype._handleMessage=function(a,b){if(!(b>this.getClient().getNeighborhood()))switch(a.type){case"close":this._remoteConnected=!1,this.close()}},d.prototype.getApi=function(){if(!this.isReady()){var a=new Error("Tried to get API but not ready for "+this);throw m.log(m.ERROR,a),a}return this._api},d.prototype._handleClose=function(a){this._remoteConnected&&!a&&this.getMessenger().sendMessage(this.getRemoteAddress(),this._remoteId,{id:this.getId(),type:"close"});var b=Object.keys(this._strategies);b.forEach(function(a){this._strategies[a].cancel()},this)}}).call(this,"/js\\app\\api\\facade\\facade.js")},{"../../endpoint/endpoint":26,"../../util/appUtils":54,"../../util/constants":55,"./strategy":17,util:85,uuid:86}],16:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);d.super_.call(this,a,{type:j.EndpointType.QUERY,id:i()}),this.registerDefaultMessengerListener(),this.getEndpointManager().registerPeriodic(this);var c=this.getEndpointManager().getService("router");this.registerObjectEvent(c,"route-available",this._routeAvailable.bind(this)),this.registerObjectEvent(c,"route-unavailable",this._routeLost.bind(this)),this._periodicCounter=0,this._name=b.name,this._version=b.version,this._criteria=b.criteria,this._bridgeId=b.bridgeId,this._hostId=b.hostId,this._tryForever=b.tryForever,this._maxHops=a.getConfiguration().get("maxHops"),this._queryNeighborhood=k.getNeighborhood(b.neighborhood,"local"),this._foundApis={},this._foundApisCount=0,this._searchQueued=!1,this._acceptNeighborhood=this._queryNeighborhood==j.Neighborhood.GLOBAL?j.Neighborhood.UNIVERSAL:this._queryNeighborhood;var e="register|"+this.getName()+"|"+this.getVersion();this.registerBusEvent(e,this._adapterRegistered.bind(this)),this.searchAdapter(this._queryNeighborhood,this._bridgeId,this._hostId,this._criteria)}var e=a("../../endpoint/endpoint"),f=a("util").inherits,g=a("../../routing/address"),h=a("xtend"),i=a("uuid"),j=a("../../util/constants"),k=a("../../util/appUtils"),l=k.getLogger(c);f(d,e),b.exports=d,d.prototype.getName=function(){return this._name},d.prototype.getVersion=function(){return this._version},d.prototype.getFoundApis=function(){return this._foundApis},d.prototype.getFoundApisCount=function(){return this._foundApisCount},d.prototype._routeAvailable=function(a,b){if(b.adjacent){if(this._hostId)return;this.searchAdapter(this._queryNeighborhood,this._bridgeId,a,this._criteria)}},d.prototype._routeLost=function(a){this._hostId==a&&(this.emit("timeout"),this.close())},d.prototype._adapterRegistered=function(a,b){b>j.Neighborhood.LOCAL||this.searchAdapter(j.Neighborhood.LOCAL,null,null,this._criteria)},d.prototype.performPeriodic=function(a){a||(this._periodicCounter++,this._periodicCounter%2===0&&(this._tryForever?0===this._foundApisCount&&l.log(l.WARN,"Could not find a suitable Adapter. Check the 'neighborhood' settings on both the Facade and Adapter to ensure they are high enough."):(0===this._foundApisCount&&this.emit("timeout"),this.close()),this.searchAdapter(this._queryNeighborhood,this._bridgeId,this._hostId,this._criteria)))},d.prototype.searchAdapter=function(a,b,c,d){this._searchQueued||(l.log(l.DEBUG3,"Queuing search request for %s",this),k.nextTick(function(){this._searchQueued=!1,l.log(l.DEBUG2,"Sending a search request [Name: %s] [Bridge: %s] [Host: %s]",this.getName(),b,c);var e={id:this.getId(),criteria:{}};d&&(e.criteria=h(d));var f="adapter|"+this.getName()+"|"+this.getVersion();b||c?this.getBus().emitDirect(b,c,a,f,e):this.getBus().emit(a,f,e)}.bind(this)),this._searchQueued=!0)},d.prototype._handleMessage=function(a,b){if(!(b>this._acceptNeighborhood))switch(a.type){case"api":this._foundApis[a.id]||(a.address=g(a.address),a.neighborhood=b,a.address.isValid(this._maxHops)&&(this._foundApis[a.id]=a,this._foundApisCount+=1,this.emit("api",a)))}}}).call(this,"/js\\app\\api\\facade\\query.js")},{"../../endpoint/endpoint":26,"../../routing/address":36,"../../util/appUtils":54,"../../util/constants":55,util:85,uuid:86,xtend:91}],17:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(e.call(this),this._route=[],this._id=g(),this._catch=null,this._executing=!1,this._endpointManager=a,void(this._currentCall=null)):new d(a)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("uuid"),h=a("./calls/base-call"),i=a("./calls/callback-call"),j=a("./calls/facade-call"),k=a("./calls/stream-call"),l=a("./calls/transform-call"),m=a("../../util/appUtils"),n=m.getLogger(c);f(d,e),b.exports=d,d.prototype.getId=function(){return this._id},d.prototype.getRoute=function(){return this._route.slice(0)},d.prototype.clearRoute=function(){this._route=[]},d.prototype.isExecuting=function(){return this._executing},d.prototype.getCatch=function(){return this._catch},d.prototype.call=function(a,b){if(this._executing)throw this.cancel(),new Error("Cannot add to an executing strategy");if(this._route.length>0)throw this.cancel(),new Error("Can only make one base call per strategy");if(!a.hasOwnProperty("isFacadeFunction")||!a.isFacadeFunction())throw this.cancel(),new Error("Must use a facade function");var c={func:a,args:this._cacheArguments(b,0),instanceId:this._endpointManager.getInstanceId()};return this._route.push(h(this._endpointManager,c)),this},d.prototype.pipe=function(a){if(this._executing)throw this.cancel(),new Error("Cannot add to an executing strategy");var b;if(a.hasOwnProperty("isFacadeFunction")&&a.isFacadeFunction())b={func:a,args:this._cacheArguments(arguments,1),instanceId:this._endpointManager.getInstanceId()},this._route.push(j(this._endpointManager,b));else if(a instanceof d){n.log(n.DEBUG2,"Concatenating passed strategy with this strategy [passed: %s] [this: %s]",a.getId(),this.getId());var c=a.getRoute();if(c.length>0){var e=c.shift();if(e.isFacadeCall()&&e.isBaseCall()){b={func:e.getFunction(),args:e.getArguments()};var f=j(this._endpointManager,b);this._route.push(f),e.close()}else this._route.push(e);this._route=this._route.concat(c),a.clearRoute()}}else if(a.pipe&&"function"==typeof a.pipe)b={forwardStream:a},arguments.length>=2&&arguments[1].pipe&&"function"==typeof arguments[1].pipe&&(b.reverseStream=arguments[1]),this._route.push(k(this._endpointManager,b));else{if("function"!=typeof a)throw this.cancel(),new Error("Must use a stream, facade function, or callback for pipe");b={inputFunc:a},arguments.length>=2&&"function"==typeof arguments[1]&&(b.outputFunc=arguments[1]),this._route.push(l(this._endpointManager,b))}return this},d.prototype.then=function(a){if(this._executing)throw this.cancel(),new Error("Cannot add to an executing strategy");if(a.hasOwnProperty("isFacadeFunction")&&a.isFacadeFunction())throw this.cancel(),new Error("Cannot use a facade function on then, use pipe");if("function"!=typeof a)throw this.cancel(),new Error("Must use a callback for then");var b={func:a};return this._route.push(i(this._endpointManager,b)),arguments.length>=2&&"function"==typeof arguments[1]&&this.catch(arguments[1]),this},d.prototype.catch=function(a){if(null!==this._catch)throw this.cancel(),new Error("Cannot catch a Strategy twice");return this._catch=a,this},d.prototype.stream=function(){if(this._executing)throw this.cancel(),new Error("Cannot add to an executing strategy");var a=this._route[0],b=a.connectInputStream();return this.execute(),b},d.prototype.facade=function(){var a=this._route[0];return a.setReturnFacade(!0),this},d.prototype.buffered=function(){if(this._executing)throw this.cancel(),new Error("Cannot add to an executing strategy");var a=this._route[0],b=!0;return arguments.length>=1&&arguments[0]===!1&&(b=!1),a.setBuffered(b),this},d.prototype.execute=function(){if(!this._executing){this._executing=!0;for(var a=this._route[0],b=null,c=0;c<this._route.length;c++){var e=this._route[c];if(null!==b&&b.pipe(e),b=e,e.isCallbackCall()){e.getFunc().length>0&&a.setReturnResult(!0);break}}var f=this,g=null,h=function(){if(f._route.length>0){var a=f._currentCall=f._route.shift();a.setResult(g),a.on("call-error",function(b,c){a.close(),f._callCatch(b,c),f.cancel()}),a.on("complete",function(){a.close(),g=a.getResult(),a.isCallbackCall()&&(g instanceof d?g.pipe(f):f._route.length>0&&(n.log(n.ERROR,"Additional items after then(), but strategy not returned"),f.cancel())),h()}),a.execute()}else n.log(n.DEBUG2,"Strategy Complete for %s",f.getId()),f.emit("complete")};n.log(n.DEBUG2,"Executing Strategy for %s",this.getId()),h()}},d.prototype._cacheArguments=function(a,b){for(var c=[],d=b;d<a.length;d++)c.push(a[d]);return c},d.prototype.cancel=function(){null!==this._currentCall&&this._currentCall.close(),this._route.forEach(function(a){a.close()}),this._route=[],this.emit("complete")},d.prototype._callCatch=function(a,b){try{null!==this._catch&&this._catch(a,b)}catch(a){n.log(n.WARN,"Issue executing catch method [exception: %s] [trace: %s]",a.toString(),a.stack)}}}).call(this,"/js\\app\\api\\facade\\strategy.js")},{"../../util/appUtils":54,"./calls/base-call":9,"./calls/callback-call":10,"./calls/facade-call":11,"./calls/stream-call":12,"./calls/transform-call":13,events:65,util:85,uuid:86}],18:[function(a,b,c){(function(b){"use strict";a("./util/polyfills");var c=a("./util/appUtils"),d=a("./util/logger"),e=a("./loader"),f=a("./switching/link-directory"),g=a("./config/configuration-factory"),h=c.getLogger(b);if(c.getGlobalObject().endpointLogLevel&&(d.logLevel=c.getGlobalObject().endpointLogLevel),c.initScriptName(),c.getGlobalObject().endpoint)h.log(h.INFO,"Endpoint.js Already Initialized");else{var i=f(),j={};c.getGlobalObject().endpointConfig&&(j=c.getGlobalObject().endpointConfig||{});var k=g(i).createDefaultBrowserConfiguration(j),l=e(i,k);c.getGlobalObject().endpoint=l,h.log(h.INFO,"Endpoint.js Initialized [Instance ID: %s]",l.getInstanceId())}}).call(this,"/js\\app\\browser.js")},{"./config/configuration-factory":19,"./loader":35,"./switching/link-directory":46,"./util/appUtils":54,"./util/logger":57,"./util/polyfills":59}],19:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?void(this._linkDirectory=a):new d(a)}var e=a("./link-support"),f=a("./configuration"),g=a("../util/appUtils"),h=g.getLogger(c);b.exports=d,d.prototype.createDefaultBrowserConfiguration=function(a){var b=g.getGlobalObject();if(e.isWorkerHub(b)||e.isWorker(b))return h.log(h.DEBUG,"Creating default web worker configuration"),this.createWebWorkerConfiguration(a);h.log(h.DEBUG,"Creating default browser configuration");var c=f(this._linkDirectory,a);if(!a.links){var d=[],i={linkId:"default-window",type:"window",settings:{origin:b.location.origin,external:!1}};d.push(i);var j={linkId:"default-worker",type:"worker",settings:{}};d.push(j);var k=e.supportsSharedWorker();if(!k&&e.supportsLocalStorage()){h.log(h.DEBUG,"Adding tab link to configuration");var l={linkId:"default-tab",type:"tab",settings:{channel:"endpointjs-default"}};d.push(l)}if(h.log(h.DEBUG,"Adding %s links to configuration",d.length),c.addLinks(d),c.get("createSharedWorker")&&k){var m=this._createSharedWorker(c.get("sharedWorkerUrl")),n=this._linkDirectory.getLink("default-worker");n.addWorker(m)}var o=b.parent;if(o&&o!==b){var p=!0;if(b.document&&"string"==typeof b.document.referrer&&b.document.referrer.indexOf(b.location.origin)==-1&&(p=!1),p){var q=this._linkDirectory.getLink("default-window");q.announceWindow(o)}}}var r=this;return g.addEventListener(b,"beforeunload",function(){r._linkDirectory.close()}),c},d.prototype.createDefaultServerConfiguration=function(a){if(h.log(h.DEBUG,"Creating default server configuration"),!a.links){var b={linkId:"default-server",type:"server",settings:{channel:"endpointjs-default"}};a.links=[b]}return f(this._linkDirectory,a)},d.prototype.createWebWorkerConfiguration=function(a){var b=f(this._linkDirectory,a);if(!a.links){var c={linkId:"default-worker",type:"worker",settings:{channel:"endpointjs-default"}};b.addLinks([c]);var d=this._linkDirectory.getLink("default-worker");d.addHub(g.getGlobalObject())}return b},d.prototype._createSharedWorker=function(a){a||(a=g.getScriptName()),h.log(h.DEBUG,"Creating shared worker hub: [URL: %s]",a);try{return new SharedWorker(a)}catch(a){h.log(h.WARN,"Issue creating shared worker [message: %s]",a.message)}}}).call(this,"/js\\app\\config\\configuration-factory.js")},{"../util/appUtils":54,"./configuration":20,"./link-support":23}],20:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);var c=[["instanceId",f()],["maxHops",10],["maxHostAffinities",25],["maxAdapterInstances",1e3],["maxClientObjects",100],["createSharedWorker",!0],["sharedWorkerUrl",null]];this._options={},c.forEach(function(a){this._options[a[0]]=b&&b.hasOwnProperty(a[0])?b[a[0]]:a[1]},this),this._linkDirectory=a,this._linkAssociation=m(),this._customLinkTypes={},this._linkCounter=1,b.links&&this.addLinks(b.links)}var e=a("../util/appUtils"),f=a("uuid"),g=a("util").isArray,h=a("../link/worker"),i=a("../link/tab"),j=a("../link/window"),k=a("../link/server"),l=a("../util/constants"),m=a("./link-association"),n=e.getLogger(c);b.exports=d,d.prototype.addLinks=function(a){a&&a.length>0&&(n.log(n.DEBUG2,"Adding: %s default links",a.length),a.forEach(function(a){this.addLink(a)},this))},d.prototype.get=function(a){return this._options[a]},d.prototype.addCustomLinkType=function(a,b){this._customLinkTypes[a]=b},d.prototype.addLink=function(a){var b;if(!a.type)throw b="No link type specified",n.log(n.ERROR,b),new Error(b);var c,d=a.linkId||this._linkCounter++,e=this.get("instanceId"),f=a.settings||{};switch(a.type){case l.LinkType.SERVER:c=k(e,d,f);break;case l.LinkType.WORKER:c=h(e,d,f);break;case l.LinkType.WINDOW:c=j(e,d,f);break;case l.LinkType.TAB:c=i(e,d,f);break;default:if(!this._customLinkTypes[a.type])throw b="Link type unknown: "+a.type,n.log(n.ERROR,b),new Error(b);c=this._customLinkTypes[a.type](e,d,f)}return this._linkDirectory.addLink(c),c},d.prototype.getLink=function(a){return this._linkDirectory.getLink(a)},d.prototype.removeLink=function(a){this._linkDirectory.removeLink(this.getLink(a))},d.prototype.getLinkAssociation=function(){return this._linkAssociation},d.prototype.createBridge=function(a,b){g(a)||(a="undefined"!=typeof a?[a]:[]);var c=this._linkAssociation.createBridge(!!b);return a.forEach(function(a){c.addLinkId(a)}),c}}).call(this,"/js\\app\\config\\configuration.js")},{"../link/server":31,"../link/tab":32,"../link/window":33,"../link/worker":34,"../util/appUtils":54,"../util/constants":55,"./link-association":21,util:85,uuid:86}],21:[function(a,b,c){"use strict";function d(){return this instanceof d?(this._linkBridges={},this._linkAssociations={},this._addLinkAssociationPtr=this._addLinkAssociation.bind(this),this._removeLinkAssociationPtr=this._removeLinkAssociation.bind(this),void(this._removeBridgePtr=this._removeBridge.bind(this))):new d}var e=a("./link-bridge");b.exports=d,d.prototype._addLinkAssociation=function(a,b){var c=this._linkAssociations[a];c||(c=this._linkAssociations[a]={_assoc:{},_count:0});var d=c._assoc[b];d||(c._count+=1,c._assoc[b]=0),c._assoc[b]+=1},d.prototype._removeLinkAssociation=function(a,b){var c=this._linkAssociations[a];if(c){var d=c._assoc[b];d&&(c._assoc[b]-=1,0===c._assoc[b]&&(delete c._assoc[b],c._count-=1),0===c._count&&delete this._linkAssociations[a])}},d.prototype.getBridge=function(a){return this._linkBridges[a]},d.prototype.createBridge=function(a){var b=e(a);return this._linkBridges[b.getId()]=b,b.on("add-association",this._addLinkAssociationPtr),b.on("remove-association",this._removeLinkAssociationPtr),b.on("closed",this._removeBridgePtr),b},d.prototype._removeBridge=function(a){var b=this._linkBridges[a];b&&(delete this._linkBridges[a],b.removeListener("add-association",this._addLinkAssociationPtr),b.removeListener("remove-association",this._removeLinkAssociationPtr),b.removeListener("closed",this._removeBridgePtr))},d.prototype.isAssociated=function(a,b){var c=this._linkAssociations[a];return!(!c||!c._assoc[b])}},{"./link-bridge":22}],22:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(e.call(this),this._id=g(),this._selfRelay=!!a,void(this._links={})):new d(a)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("uuid"),h=a("../util/appUtils"),i=h.getLogger(c);f(d,e),b.exports=d,d.prototype.getId=function(){return this._id},d.prototype.hasLinkId=function(a){return!!this._links[a]},d.prototype.addLinkId=function(a){var b=this._links[a];b||(this._event("add-association",a),this._links[a]=!0)},d.prototype.removeLinkId=function(a){var b=this._links[a];b&&(delete this._links[a],this._event("remove-association",a))},d.prototype._event=function(a,b){this._selfRelay&&(i.log(i.DEBUG3,"Emitting self relay %s for %s",a,b),this.emit(a,b,b)),Object.keys(this._links).forEach(function(c){i.log(i.DEBUG3,"Emitting %s for %s <-> %s",a,b,c),this.emit(a,c,b),this.emit(a,b,c)},this)},d.prototype.close=function(){Object.keys(this._links).forEach(function(a){this._event("remove-association",a)},this),this.emit("closed",this.getId())}}).call(this,"/js\\app\\config\\link-bridge.js")},{"../util/appUtils":54,events:65,util:85,uuid:86}],23:[function(a,b,c){(function(c){"use strict";var d=a("../util/appUtils"),e=d.getLogger(c);b.exports={isWorkerHub:function(a){return"onconnect"in a},isWorker:function(a){return"undefined"!=typeof WorkerGlobalScope&&a instanceof WorkerGlobalScope},supportsLocalStorage:function(){var a=d.getGlobalObject(),b=a.localStorage,c=!0;try{b.setItem("__test_support",""),b.removeItem("__test_support")}catch(a){c=!1}var f=b&&c&&("function"==typeof a.addEventListener||"function"==typeof a.attachEvent);return e.log(e.DEBUG3,"Local Storage Supported: %s",f),f},supportsSharedWorker:function(){if("function"!=typeof SharedWorker)return!1;var a=d.getScriptName();if(a){if(!/endpoint/.test(a))return e.log(e.ERROR,"Endpoint.js Script must be synchronously loaded and have endpoint in the name to use Shared Worker transport"),!1;var b=d.getGlobalObject().document.createElement("a");b.href=a;var c=d.getGlobalObject().location;if(c.protocol==b.protocol&&c.hostname==b.hostname&&c.port==b.port)return!0}return e.log(e.WARN,"Cannot create shared worker, unknown script name or cross-domain issue."),!1}}}).call(this,"/js\\app\\config\\link-support.js")},{"../util/appUtils":54}],24:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(this._id=b.get("instanceId"),this._sequence=1,l.call(this),this.setMaxListeners(0),this._hosts={},this._linkAssociation=b.getLinkAssociation(),this._routerInstance=a,this._routerInstance.addHandler("bus"),this._routerInstance.on("route-available",this._handleRouteAvailable.bind(this)),this._routerInstance.on("route-change",this._handleRouteChange.bind(this)),this._routerInstance.on("route-unavailable",this._handleRouteLost.bind(this)),void this._routerInstance.on("bus",this._handleBusPacket.bind(this))):new d(a,b)}var e=a("../util/appUtils"),f=e.getLogger(c),g=a("../routing/address"),h=a("../util/constants"),i=a("util").isArray,j=a("xtend"),k=a("util").inherits,l=a("events").EventEmitter;k(d,l),b.exports=d,d.prototype._handleRouteAvailable=function(a,b){this._hosts[a]={address:a,linkId:b.linkId,adjacent:b.adjacent,external:b.external,sequence:-1},b.adjacent?f.log(f.DEBUG,"Discovered new adjacent host [id: %s]",a):f.log(f.DEBUG,"Discovered new non-adjacent host [id: %s]",a)},d.prototype._handleRouteChange=function(a,b){this._hosts[a].adjacent=b.adjacent,this._hosts[a].linkId=b.linkId},d.prototype._handleRouteLost=function(a){delete this._hosts[a]},d.prototype._handleBusPacket=function(a,b,c){var d=this._hosts[b];if(!d)return void f.log(f.WARN,"Received bus packet from unknown host (ignoring): %s",b);if(!i(a.path)||!i(a.event))return void f.log(f.WARN,"Invalid packet from %s: %j",b,a);var e;if(e=d.external?this._handleExternalBusPacket(a,d):this._handleInternalBusPacket(a,b)){if(a.seq=parseInt(a.seq),a.seq<=e.sequence)return void f.log(f.TRACE,"Ignored duplicate event packet: %j",a);if(e.sequence=a.seq,d.external&&(a.seq=this._sequence++),this._hasAlreadySeenPacket(a,e))return void f.log(f.TRACE,"Already seen that packet (path violation)");f.log(f.TRACE,"Read event packet: %j",a),this._emitPacket(a,c),this._forwardPacket(a,d,null)}},d.prototype._hasAlreadySeenPacket=function(a,b){for(var c=0,d=0;d<a.path.length;d++)if(a.path[d]==b.address&&(c+=1),a.path[d]==this._id||c>=2)return!0;return!1},d.prototype._handleInternalBusPacket=function(a,b){if(0===a.path.length)return f.log(f.WARN,"Empty path from %s: %j",b,a),!1;var c=a.path[a.path.length-1],d=this._hosts[c];return d?d:(f.log(f.WARN,"Received bus packet from unknown originator (ignoring): %s",c),!1)},d.prototype._handleExternalBusPacket=function(a,b){return a.path=a.path.concat(b.address),a.mode===h.Neighborhood.GLOBAL&&(a.mode=h.Neighborhood.GROUP),b},d.prototype._emitPacket=function(a,b){try{if(l.listenerCount(this,a.event[0])){var c=g(a.path.concat(this._id)),d=a.event.slice(0);d.splice(1,0,c,b),l.prototype.emit.apply(this,d)}}catch(a){f.log(f.ERROR,"Exception executing event: %s %s",a.message,a.stack)}},d.prototype._forwardPacket=function(a,b,c,d){if(!(a.mode<=h.Neighborhood.LOCAL)){for(var e,g,i=0===a.path.length,k=!!b&&b.external,l=b?b.address:"local",m={},n=0;n<a.path.length;n++)m[a.path[n]]=!0;m[l]=!0,f.log(f.TRACE,"Relay event packet to hosts: %j",a);var o;c&&(o=this._linkAssociation.getBridge(c));for(var p in this._hosts)if(!m||!m[p]){var q=this._hosts[p];if(o&&!o.hasLinkId(q.linkId))continue;if(d&&p!==d)continue;if(q.adjacent&&(!q.external||q.external&&a.mode>h.Neighborhood.GROUP)){var r=a;(k&&!q.external||i&&!q.external||!i&&!k&&q.external)&&(g||(g=j(a,{path:a.path.concat(this._id)})),r=g),!i&&q.external&&(e||(e=j(a,{path:a.path.concat(this._id),seq:this._sequence++})),r=e),this._routerInstance.sendPacket(p,"bus",r,l)}}}},d.prototype._createPacket=function(a,b){var c={event:b,seq:this._sequence++,mode:a,path:[]};return c},d.prototype.emitDirect=function(a,b,c){var d=this._createPacket(c,this._convertArgs(arguments,3));this._forwardPacket(d,null,a,b)},d.prototype.emit=function(a){var b=this._createPacket(a,this._convertArgs(arguments,1));this._emitPacket(b,h.Neighborhood.LOCAL),this._forwardPacket(b,null,null,null)},d.prototype._convertArgs=function(a,b){for(var c=[],d=b;d<a.length;d++)c.push(a[d]);return c}}).call(this,"/js\\app\\endpoint\\bus.js")},{"../routing/address":36,"../util/appUtils":54,"../util/constants":55,events:65,util:85,xtend:91}],25:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(this._endpoints={},this._periodic={},this._config=a,this._services=b,this._timer=f("Endpoint Manager",5e3),void this._timer.on("period",this._performPeriodic.bind(this))):new d(a,b)}var e=a("./endpoint"),f=a("../util/periodic-timer"),g=a("../util/appUtils"),h=a("uuid"),i=g.getLogger(c);b.exports=d,d.prototype.getInstanceId=function(){return this._config.get("instanceId")},d.prototype.getConfiguration=function(){return this._config},d.prototype.getService=function(a){return this._services[a]},d.prototype._performPeriodic=function(a){if(!a){var b=Object.keys(this._periodic);i.log(i.DEBUG,"Executing endpoint manager periodic for %s endpoints",b.length),b.forEach(function(a){try{this._endpoints[a]?this._endpoints[a].performPeriodic():i.log(i.DEBUG2,"Endpoint was removed before periodic executed for %s",a)}catch(b){i.log(i.WARN,"Issue executing periodic for %s [message: %s] [stack: %s]",this._endpoints[a],b.message,b.stack)}},this)}},d.prototype.registerPeriodic=function(a){this._periodic[a.getId()]||(i.log(i.DEBUG3,"Endpoint registered for periodic updates %s",a),this._timer.addReference(),this._periodic[a.getId()]=!0)},d.prototype.unregisterPeriodic=function(a){this._periodic[a.getId()]&&(i.log(i.DEBUG3,"Endpoint unregistered for periodic updates %s",a),delete this._periodic[a.getId()],this._timer.removeReference())},d.prototype.registerEndpoint=function(a){this._endpoints[a.getId()]=a,i.log(i.DEBUG2,"Endpoint registered with endpoint manager %s",a),a.on("closed",function(){delete this._endpoints[a.getId()],this.unregisterPeriodic(a)}.bind(this))},d.prototype.createEndpoint=function(a,b,c){return a||(a=h()),e(this,{id:a,type:b,identification:c})},d.prototype.closeAll=function(){var a=Object.keys(this._endpoints);a.forEach(function(a){this._endpoints[a].close()},this)}}).call(this,"/js\\app\\endpoint\\endpoint-manager.js")},{"../util/appUtils":54,"../util/periodic-timer":58,"./endpoint":26,uuid:86}],26:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this),this.setMaxListeners(0),this._type=b.type,this._id=b.id,this._endpointManager=a,this._identifierString=g("[%s] [id: %s]",this.getType(),this.getId()),b.identification&&(this._identifierString+=" "+b.identification),this._endpointManager.registerEndpoint(this),this._registeredListeners={},this._listenerCtr=1,void(this._closing=!1)):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("util").format,h=a("../util/appUtils"),i=h.getLogger(c);f(d,e),b.exports=d,d.prototype.getId=function(){return this._id},d.prototype.getInstanceId=function(){return this._endpointManager.getInstanceId()},d.prototype.getType=function(){return this._type},d.prototype.getBus=function(){return this._endpointManager.getService("bus")},d.prototype.getMessenger=function(){return this._endpointManager.getService("messenger")},d.prototype.getStreamer=function(){return this._endpointManager.getService("streamer")},d.prototype.getHostAffinity=function(){return this._endpointManager.getService("hostaffinity")},d.prototype.getEndpointManager=function(){return this._endpointManager},d.prototype.performPeriodic=function(){throw new Error("not implemented")},d.prototype.registerDefaultMessengerListener=function(){this.registerMessenger(this.getId(),this._handleMessage.bind(this))},d.prototype.registerDefaultStreamerListener=function(){this.registerStreamer(this.getId(),this._handleStream.bind(this))},d.prototype.registerDefaultBusEventListener=function(){this.registerBusEvent(this.getId(),this._handleBusEvent.bind(this))},d.prototype.registerBusEvent=function(a,b){var c=this._addListener({type:"bus",event:a,callback:b});return this.getBus().on(a,b),i.log(i.DEBUG3,"Added bus event listener %s for %s",a,this),c},d.prototype.registerObjectEvent=function(a,b,c){var d=this._addListener({type:"object-event",object:a,event:b,callback:c});return a.on(b,c),i.log(i.DEBUG3,"Added object event listener %s for %s",b,this),d},d.prototype.registerMessenger=function(a,b){var c=this._addListener({type:"messenger",id:a});return this.getMessenger().register(a,b),i.log(i.DEBUG3,"Added messenger %s for %s",a,this),c},d.prototype.registerStreamer=function(a,b){var c=this._addListener({type:"streamer",key:a,callback:b});return this.getStreamer().addHandler(a),this.getStreamer().on("stream-"+a,b),i.log(i.DEBUG3,"Added streamer %s for %s",a,this),c},d.prototype._addListener=function(a){var b=this._listenerCtr;return this._registeredListeners[b]=a,this._listenerCtr+=1,b},d.prototype.close=function(a){if(this._closing)return void i.log(i.DEBUG3,"Already Closed: %s",this);i.log(i.DEBUG2,"Closing %s",this),this._closing=!0;var b=Object.keys(this._registeredListeners);b.forEach(function(a){this.closeListener(a)}.bind(this)),"function"==typeof this._handleClose&&this._handleClose(!!a),this.emit("closed",!!a)},d.prototype.closeListener=function(a){var b=this._registeredListeners[a];if(b)switch(b.type){case"streamer":this.getStreamer().removeHandler(b.key),this.getStreamer().removeListener("stream-"+b.key,b.callback);break;case"messenger":this.getMessenger().unRegister(b.id);break;case"bus":this.getBus().removeListener(b.event,b.callback);break;case"object-event":b.object.removeListener(b.event,b.callback);break;default:i.log(i.ERROR,"Unknown endpoint type %s for %s",b.type,this)}},d.prototype._handleMessage=function(a){i.log(i.ERROR,"Message method not implemented for %s",this)},d.prototype._handleBusEvent=function(a){i.log(i.ERROR,"Bus Event method not implemented for %s",this)},d.prototype._handleStream=function(a,b){i.log(i.ERROR,"Stream method not implemented for %s",this),a.end()},d.prototype.attachStream=function(a){var b=function(){i.log(i.DEBUG2,"Endpoint closed, ending stream [id = %s]",a.id),a.end()};this.once("closed",b);var c=function(){this.removeListener("closed",b)}.bind(this);a.on("end",c),a.on("finish",c)},d.prototype.attachEndpoint=function(a){var b=function(){a.close(!0)};this.once("closed",b);var c=function(){this.removeListener("closed",b)}.bind(this);a.on("closed",c)},d.prototype.trackEndpointAffinity=function(a){if(a&&null!==a){var b=function(a){i.log(i.DEBUG,"Received affinity message %s for %s",a,this),"remove"==a&&this.close(!0)}.bind(this);this.getHostAffinity().once(a,b),this.once("closed",function(){this.getHostAffinity().removeListener(a,b)}.bind(this))}},d.prototype.toString=function(){return this._identifierString}}).call(this,"/js\\app\\endpoint\\endpoint.js")},{"../util/appUtils":54,events:65,util:85}],27:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._id=c.get("instanceId"),this._listeners={},this._pathInstance=a,this._routerInstance=b,this._routerInstance.addHandler("message"),this._routerInstance.on("message",this._handleMessagePacket.bind(this)),void this._routerInstance.on("message-error",this._handleMessageError.bind(this))):new d(a,b,c)}var e=a("../util/appUtils"),f=e.getLogger(c);b.exports=d,d.prototype.register=function(a,b){if(this._listeners[a])f.log(f.WARN,"The listener [id: %s] cannot be registered because it is already registered",a);else{if("function"!=typeof b){var c=new Error("Must register a function callback");throw f.log(f.ERROR,c.message),c}this._listeners[a]=b}},d.prototype.unRegister=function(a){this._listeners[a]?delete this._listeners[a]:f.log(f.WARN,"The listener [id: %s] cannot be removed because it is not registered",a)},d.prototype.sendMessage=function(a,b,c){var d={id:b,msg:c};f.log(f.TRACE,"Outbound Messenger Packet: %j",c),this._pathInstance.sendPacket(a,"message",d)},d.prototype._handleMessagePacket=function(a,b,c){if(a.id)if(this._listeners[a.id]){f.log(f.TRACE,"Inbound Messenger Packet: %j",a);try{this._listeners[a.id](a.msg,c)}catch(b){f.log(f.WARN,"Issue delivering message packet [id: %s] [exception: %s] [trace: %s]",a.id,b.toString(),b.stack)}}else f.log(f.WARN,"Unknown messenger id: %j",a);else f.log(f.ERROR,"Malformed messenger packet: %j",a)},d.prototype._handleMessageError=function(a,b){f.log(f.ERROR,"Couldn't route message for %j: %j",b,a)}}).call(this,"/js\\app\\endpoint\\messenger.js")},{"../util/appUtils":54}],28:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(e.call(this),this.setMaxListeners(0),this._id=c.get("instanceId"),this._streamInfo={},this._handlers={},this._multiplexer=h(),this._multiplexer.on("readable",this._handleMultiplexerOutbound.bind(this)),this._multiplexer.on("stream",this._handleMultiplexerStream.bind(this)),this._pathInstance=a,this._routerInstance=b,this._routerInstance.addHandler("stream"),this._routerInstance.on("stream",this._handleStreamPacket.bind(this)),void this._routerInstance.on("stream-error",this._handleStreamError.bind(this))):new d(a,b,c)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../routing/address"),h=a("../streams/mux-stream"),i=a("uuid"),j=a("../util/appUtils"),k=j.getLogger(c);f(d,e),b.exports=d,d.prototype._handleMultiplexerOutbound=function(){for(var a;null!==(a=this._multiplexer.read());){var b=this._streamInfo[a.id];b&&(b.local&&(a.id=b.localId),this._pathInstance.sendPacket(b.remoteAddress,"stream",a))}},d.prototype._handleStreamPacket=function(a,b,c){
var d=a.id,e=this._streamInfo[d];if(e)if(e.source){if(c!==e.source)return void k.log(k.WARN,"Packet does not match original source %s: %j",c,a)}else e.source=c;else this._streamInfo[d]={local:"local"==b,source:c,remoteAddress:null};this._multiplexer.write(a)},d.prototype._handleStreamError=function(a){var b=a.id,c=this._multiplexer.getStream(b);c&&c.end()},d.prototype._handleMultiplexerStream=function(a,b){if(!a.meta||!a.meta.type)return k.log(k.ERROR,"Unknown stream type: %j",a.meta),void a.end();if(!this.hasHandler(a.meta.type))return k.log(k.ERROR,"No handler for stream type: %s",a.meta.type),void a.end();var c,d=this._streamInfo[a.id];d.local?(d.localId=a.id.substring(0,a.id.length-6),c=g("local")):c=g(a.meta.address),d.remoteAddress=c;var e=a.meta.type;a.meta=a.meta.meta;var f=this;a.on("finish",function(){k.log(k.DEBUG2,"Cleaning up old stream after end: %s",a.id),delete f._streamInfo[a.id]}),k.log(k.DEBUG2,"Received new stream: [local: %s] [id: %s]",d.local,a.id),this.emit("stream-"+e,a,b)},d.prototype.createStream=function(a,b,c,d){var e,f=b.getPathVector(),g=i(),h=this._streamInfo[g]={local:0===f.length||f[f.length-1]==this._id,localId:g+".local",remoteAddress:b},j={address:f,type:a,meta:c};try{e=this._multiplexer.createStream(j,d,g)}catch(a){throw delete this._streamInfo[g],a}var l=this;return e.on("finish",function(){k.log(k.DEBUG2,"Cleaning up old stream after end: %s",g),delete l._streamInfo[g]}),k.log(k.DEBUG2,"Created new stream [local: %s] [id: %s]",h.local,g),e},d.prototype.getStreamInfo=function(a){return this._streamInfo[a]},d.prototype.addHandler=function(a){this._handlers[a]=!0,k.log(k.DEBUG3,"Added stream handler [name: %s]",a)},d.prototype.removeHandler=function(a){this._handlers[a]?(delete this._handlers[a],k.log(k.DEBUG3,"Removed stream handler [name: %s]",a)):k.log(k.WARN,"That handler isn't registered [name: %s]",a)},d.prototype.hasHandler=function(a){return!!this._handlers[a]}}).call(this,"/js\\app\\endpoint\\streamer.js")},{"../routing/address":36,"../streams/mux-stream":44,"../util/appUtils":54,events:65,util:85,uuid:86}],29:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(this._linkId=a,this._settings=b,void h.log(h.DEBUG,"Link initialized: [Type: %s] [ID: %s]",this.getType(),this.getId())):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype.getHeartbeatTimeout=function(){return this._settings.heartbeatTimeout},d.prototype.getTransformFactory=function(){return this._settings.transformFactory},d.prototype.getType=function(){return new Error("not implemented")},d.prototype.getId=function(){return this._linkId},d.prototype.getCost=function(){return 0},d.prototype.isExternal=function(){return!1},d.prototype.close=function(){h.log(h.DEBUG,"Link closed: [Type: %s] [ID: %s]",this.getType(),this.getId())}}).call(this,"/js\\app\\link\\link.js")},{"../util/appUtils":54,events:65,util:85}],30:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._instanceId=a,e.call(this,b,c),this._handshakes=h(15,"Protocol link: "+b),this._handshakes.on("expired",function(a,b){j.log(j.WARN,"Host exchange expired"),b.closeFn()}),void(this._streams={})):new d(a,b,c)}var e=a("./link"),f=a("util").inherits,g=a("uuid"),h=a("../util/expirable-hash"),i=a("../util/appUtils"),j=i.getLogger(c),k=a("through2");f(d,e),b.exports=d,d.prototype._handleGreeting=function(a,b,c){function d(){l||(j.log(j.DEBUG,"Lost connection: [Link Type: %s] [Link ID: %s] [Edge ID: %s] [From: %s]",m.getType(),m.getId(),h.edgeId,h.instanceId),l=!0,h.readTransport.push(null),h.readTransport.end(),h.ready?(delete m._streams[e],m.emit("connection-close",m,h.edgeId)):(m._handshakes.remove(e),h.sendTransport.push(null),h.sendTransport.end()))}var e=g();if(c=c||a.s,b=b||g(),!i.isUuid(c)||!i.isUuid(b))throw new Error("Invalid instance or edge id");var f={d:a.s,s:e},h={streamId:e,instanceId:c||a.s,edgeId:this.isExternal()?b:c,ready:!1,readTransport:k.obj(),sendTransport:this._createInjectStream(f,a),closeFn:d},l=!1,m=this;return h.sendTransport.on("finish",d),h.sendTransport.on("end",d),this._handshakes.add(e,h),j.log(j.DEBUG,"New connection: [Link Type: %s] [Link ID: %s] [Edge ID: %s] [From: %s]",this.getType(),this.getId(),h.edgeId,h.instanceId),h},d.prototype._handleGoodbye=function(a){var b=this._streams[a.d];b&&(b.readTransport.push(null),b.readTransport.end())},d.prototype._sendProtocolCommand=function(a,b,c){var d=this._streams[a]||this._handshakes.get(a);d&&this._sendProtocolCommandTo(d.sendTransport,b,c)},d.prototype._sendProtocolCommandTo=function(a,b,c){a.write({p:b,m:c})},d.prototype._createInjectStream=function(a,b){var c=k.obj(function(b,c,d){for(var e in a)b[e]=a[e];this.push(b),d()});return c.updateInject=function(b){a=b},c.pipe(this._createSenderStream(b)),c},d.prototype._handleReady=function(a,b){var c=a.d,d=this._handshakes.get(c);if(d&&!d.ready){if(b){if(!i.isUuid(b))throw new Error("Invalid instance id");d.instanceId=b}return d.sendTransport.updateInject({d:a.s}),d.ready=!0,this._streams[d.streamId]=d,this._handshakes.remove(d.streamId),this.emit("connection",this,d.edgeId,{read:d.readTransport,write:d.sendTransport},d.instanceId),!0}return!1},d.prototype._handleReader=function(a){var b={},c=function(a){b[a]||(b[a]=this._streams[a].readTransport,b[a].once("end",function(){delete b[a]}))}.bind(this),d=function(){for(var b;null!==(b=a.read());)if(b&&b.d)try{var d;if(b.p)switch(b.p){case"greetings":"broadcast"==b.d&&b.s!=this._instanceId&&(d=this._handleGreeting(b),this._sendProtocolCommand(d.streamId,"hi",{i:this._instanceId,e:d.edgeId}));break;case"hi":b.d==this._instanceId&&b.m&&(d=this._handleGreeting(b,b.m.e,b.m.i),this._sendProtocolCommand(d.streamId,"ready"),b.d=d.streamId,this._handleReady(b,b.m.i),c(b.d));break;case"ready":this._handleReady(b)&&c(b.d);break;case"goodbye":this._handleGoodbye(b)}else d=this._streams[b.d],d&&d.readTransport.push(b)}catch(a){j.log(j.ERROR,"Exception reading: %s",a.stack)}}.bind(this),e=function(){a.removeListener("readable",d);for(var c in b)b[c].push(null);b={}}.bind(this);a.once("end",e),a.on("readable",d)},d.prototype._announce=function(a){var b={d:"broadcast",s:this._instanceId},c=this._createInjectStream(b,a);this._sendProtocolCommandTo(c,"greetings"),c.end()},d.prototype._createSenderStream=function(a){return new Error("not implemented")},d.prototype.closeLink=function(a){var b=this._streams[a];b&&(this._sendProtocolCommandTo(b.sendTransport,"goodbye"),b.closeFn())},d.prototype.close=function(){var a=Object.keys(this._streams);a.forEach(function(a){this.closeLink(a)},this),e.prototype.close.call(this)}}).call(this,"/js\\app\\link\\protocol-link.js")},{"../util/appUtils":54,"../util/expirable-hash":56,"./link":29,through2:81,util:85,uuid:86}],31:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._channel=c.channel||"local-channel",this._external=!c.hasOwnProperty("external")||c.external,this._maxClients=c.hasOwnProperty("maxClients")?c.maxClients:250,this._listeners=[],this._currentClients=0,this._connectEventPtr=this._onConnect.bind(this),e.call(this,a,b,c),void j.log(j.DEBUG2,"Server Link initialized: [Settings: %j]",c)):new d(a,b,c)}var e=a("./protocol-link"),f=a("util").inherits,g=a("../transport/socketio"),h=a("through2"),i=a("../util/appUtils"),j=i.getLogger(c);f(d,e),b.exports=d,d.prototype.isExternal=function(){return this._external},d.prototype.addSocket=function(a,b){if(b)a.on("connection",this._connectEventPtr),this._listeners.push(a);else{var c=this;a.on("connect",function(){var b=c._onConnect(a);c.announceSocket(b)})}},d.prototype._onConnect=function(a){var b=g({channel:this._channel,target:a});if(this._currentClients>=this._maxClients)return j.log(j.WARN,"Max clients connected. Closing new connection"),void b.close();var c=this;b.on("finish",function(){c._currentClients-=1});var d=h.obj(function(a,c,d){a.stream=b,this.push(a),d()});return b.pipe(d),this._handleReader(d),this._currentClients+=1,b},d.prototype._createSenderStream=function(a){var b=h.obj();return b.pipe(a.stream,a.announce?{end:!1}:void 0),b},d.prototype.announceSocket=function(a){this._announce({stream:a,announce:!0})},d.prototype.getCost=function(){return 100},d.prototype.getType=function(){return"server"},d.prototype.close=function(){this._listeners.length>0&&(this._listeners.forEach(function(a){a.removeListener("connection",this._connectEventPtr)},this),this._listeners=[]),e.prototype.close.call(this)}}).call(this,"/js\\app\\link\\server.js")},{"../transport/socketio":53,"../util/appUtils":54,"./protocol-link":30,through2:81,util:85}],32:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._channel=c.channel||"local-channel",e.call(this,a,b,c),this._transportStream=h({channel:this._channel}),this._readStream=this._transportStream.pipe(g.decode(!0)).pipe(this._createDecodeStream()),this._writeStream=this._createEncodeStream(),this._writeStream.pipe(g.encode(!0)).pipe(this._transportStream),this._handleReader(this._readStream),this._announce(),void j.log(j.DEBUG2,"Tab Link initialized: [Settings: %j]",c)):new d(a,b,c)}var e=a("./protocol-link"),f=a("util").inherits,g=a("../streams/stringify-stream"),h=a("../transport/localstorage"),i=a("../util/appUtils"),j=i.getLogger(c),k=a("through2");f(d,e),b.exports=d,d.prototype._createDecodeStream=function(){var a=null,b=null;return k.obj(function(c,d,e){a===c.c&&b===c.s?e():(a=c.c,b=c.s,this.push(c),e())})},d.prototype._createEncodeStream=function(){var a=1;return k.obj(function(b,c,d){b.c=a++,a>65536&&(a=1),this.push(b),d()})},d.prototype._createSenderStream=function(a){var b=k.obj();return b.pipe(this._writeStream,{end:!1}),b},d.prototype.getCost=function(){return 10},d.prototype.getType=function(){return"tab"},d.prototype.close=function(){e.prototype.close.call(this),this._transportStream.close()}}).call(this,"/js\\app\\link\\tab.js")},{"../streams/stringify-stream":45,"../transport/localstorage":50,"../util/appUtils":54,"./protocol-link":30,through2:81,util:85}],33:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._origin=c.origin,this._external=!c.hasOwnProperty("external")||c.external,e.call(this,a,b,c),this._transportStream=k({target:g.getGlobalObject(),origin:this._origin,checkOrigin:!0,preserveSource:!0}),this._readStream=this._transportStream.pipe(i.obj(function(a,b,c){a.msg=j.decodeFunction(!0,a.msg),this.push(a),c()})).pipe(this._createDecodeStream()),this._handleReader(this._readStream),void h.log(h.DEBUG2,"Window Link initialized: [Settings: %j]",c)):new d(a,b,c)}var e=a("./protocol-link"),f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c),i=a("through2"),j=a("../streams/stringify-stream"),k=a("../transport/postmessage-reader"),l=a("../transport/postmessage-sender");f(d,e),b.exports=d,d.prototype.isExternal=function(){return this._external},d.prototype._createDecodeStream=function(){return i.obj(function(a,b,c){var d=a.msg;d.source=a.source,d.origin=a.origin,this.push(d),c()})},d.prototype._createSenderStream=function(a){var b=l({target:a.source,origin:this._origin,sendOrigin:!0}),c=j.encode(!0);return c.pipe(b),c},d.prototype.announceWindow=function(a){this._announce({source:a})},d.prototype.getCost=function(){return 1},d.prototype.getType=function(){return"window"},d.prototype.close=function(){e.prototype.close.call(this),this._transportStream.close()}}).call(this,"/js\\app\\link\\window.js")},{"../streams/stringify-stream":45,"../transport/postmessage-reader":51,"../transport/postmessage-sender":52,"../util/appUtils":54,"./protocol-link":30,through2:81,util:85}],34:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return this instanceof d?(this._workerHub=null,e.call(this,a,b,c),void h.log(h.DEBUG2,"Worker Link initialized: [Settings: %j]",c)):new d(a,b,c)}var e=a("./protocol-link"),f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c),i=a("through2"),j=a("../streams/stringify-stream"),k=a("../transport/postmessage-reader"),l=a("../transport/postmessage-sender");f(d,e),b.exports=d,d.prototype.addWorker=function(a){var b=this.addHub(a);this.announceWorker(b)},d.prototype.addHub=function(a){if("port"in a&&(a=a.port),"onconnect"in a){if(null!==this._workerHub){var b="Already assigned a worker hub";throw h.log(h.ERROR,b),new Error(b)}return this._workerHub=a,this._connectEventPtr=this._onConnect.bind(this),g.addEventListener(a,"connect",this._connectEventPtr,!1),h.log(h.DEBUG2,"Worker scope detected, using hub mode"),null}var c={ports:[a]},d=this._onConnect(c);return h.log(h.DEBUG2,"Using worker client mode"),d},d.prototype._onConnect=function(a){function b(){d.close()}var c=a.ports[0],d=k({target:c,checkOrigin:!1}),e={port:c,cleanUp:b},f=i.obj(function(a,b,c){a.meta=e,this.push(a),c()});return d.pipe(j.decode(!0)).pipe(f),this._handleReader(f),"start"in c&&c.start(),c},d.prototype._createSenderStream=function(a){var b=l({target:a.meta.port,sendOrigin:!1}),c=j.encode(!0);return c.pipe(b),c.on("finish",function(){a.meta.cleanUp&&a.meta.cleanUp()}),c},d.prototype.getCost=function(){return 1.1},d.prototype.getType=function(){return"worker"},d.prototype.announceWorker=function(a){this._announce({meta:{port:a}})},d.prototype.close=function(){this._workerHub&&g.removeEventListener(this._workerHub,"connect",this._connectEventPtr,!1),e.prototype.close.call(this)}}).call(this,"/js\\app\\link\\worker.js")},{"../streams/stringify-stream":45,"../transport/postmessage-reader":51,"../transport/postmessage-sender":52,"../util/appUtils":54,"./protocol-link":30,through2:81,util:85}],35:[function(a,b,c){"use strict";function d(a,b){var c=e(a,b),d=f(c,b),n=g(d,b),o=i(d,b),p=h(d,b),q=k(n,d,b),r=j(n,d,b),s={switchboard:c,router:d,path:n,bus:o,hostaffinity:p,messenger:q,streamer:r},t=l(b,s),u=m(t,b);return u}var e=a("./switching/switch-board"),f=a("./routing/router"),g=a("./routing/path-vector"),h=a("./routing/host-affinity"),i=a("./endpoint/bus"),j=a("./endpoint/streamer"),k=a("./endpoint/messenger"),l=a("./endpoint/endpoint-manager"),m=a("./api/api");b.exports=d},{"./api/api":6,"./endpoint/bus":24,"./endpoint/endpoint-manager":25,"./endpoint/messenger":27,"./endpoint/streamer":28,"./routing/host-affinity":37,"./routing/path-vector":38,"./routing/router":39,"./switching/switch-board":48}],36:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(a?e(a)?this._pathVector=a.slice(0):this._pathVector=[a.toString()]:this._pathVector=[],void(this._reversed=!!b)):new d(a,b)}var e=a("util").isArray,f=a("../util/appUtils"),g=f.getLogger(c);b.exports=d,d.prototype.toString=function(){return this.getPathVector().join(".")},d.prototype.getPathVector=function(){return this._reversed||(this._pathVector=this._pathVector.reverse(),this._reversed=!0),this._pathVector.slice(0)},d.prototype.routeThrough=function(a){if(!this.isValid())throw new Error("invalid address");var b=this.getPathVector(),c=a.getPathVector();if(b[b.length-1]!==c[0]){var e="While merging two addresses, end of first must be beginning of second";throw g.log(g.ERROR,e),new Error(e)}for(var h={},i=0;i<c.length;i++)h[c[i]]=i;for(var j=null,k=null,l=null,m=0;m<b.length;m++){var n=h[b[m]];if(void 0!==n){var o=m+n;(null===k||o<j)&&(k=m,l=n)}}f.isExtUuid(c[l])&&(l+=1);var p=b.slice(0,k).concat(c.slice(l));return new d(p,!0)},d.prototype.isValid=function(a){var b=this.getPathVector();if("undefined"!=typeof a&&b.length>a)return g.log(g.WARN,"max hops violation: %s",this),!1;for(var c={},d=0;d<b.length;d++){if(!f.isUuid(b[d])&&!f.isExtUuid(b[d]))return g.log(g.WARN,"uuid violation: %s",this),!1;if(c[b[d]])return g.log(g.WARN,"loop violation: %s",this),!1;c[b[d]]=!0}return!0}}).call(this,"/js\\app\\routing\\address.js")},{"../util/appUtils":54,util:85}],37:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this),this.setMaxListeners(0),this._id=b.get("instanceId"),this._maxHostAffinities=b.get("maxHostAffinities"),this._maxHops=b.get("maxHops"),this._trackedHosts={},this._localAffinities={},this._routerInstance=a,this._routerInstance.addHandler("affinity"),this._routerInstance.on("route-unavailable",this._handleRouteLost.bind(this)),void this._routerInstance.on("affinity",this._handleAffinityPacket.bind(this))):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("util").isArray,h=a("./address"),i=a("uuid"),j=a("../util/appUtils"),k=j.getLogger(c);f(d,e),b.exports=d,d.prototype._handleAffinityPacket=function(a,b){var c=this._routerInstance.getRoute(b);if(c)switch(c.external||(b=a.from),a.type){case"add":this._handleAdd(a,b);break;case"remove":this._handleRemove(a,b);break;case"error":this._handleError(a,b)}},d.prototype._handleAdd=function(a,b){if(a.id&&g(a.path)&&j.isUuid(a.id)){var c=h(a.path,!0);if(c.isValid(this._maxHops)){for(var d=c.getPathVector(),e=this._id;e==this._id&&d.length>0;)e=d[0],d.shift();e==this._id&&(e="local");var f,i;f=this._addTrackedRecord(b,e,a.id,!0),f&&("local"==e||this._routerInstance.getRoute(e))&&(i=this._addTrackedRecord(e,b,a.id,!1)),f&&i?this._sendProtocolMessage(e,"add",a.id,b,d):(f&&this._removeTrackedRecord(b,a.id),this._sendProtocolMessage(b,"error",a.id,"local"))}}},d.prototype._handleRemove=function(a,b){if(g(a.id)){var c={};a.id.forEach(function(a){var d=this._removeTrackedRecord(b,a);d&&(c[d]=c[d]||[],c[d].push(a),this._removeTrackedRecord(d,a))},this);for(var d in c)k.log(k.DEBUG3,"Sending affinity (remove) message to host %s with %s items",d,c[d].length),this._sendProtocolMessage(d,"remove",c[d],"local")}},d.prototype._handleError=function(a,b){if(a.id&&!g(a.id)){var c=this._removeTrackedRecord(b,a.id);c&&(this._removeTrackedRecord(c,a.id),this._sendProtocolMessage(c,"error",a.id,"local"))}},d.prototype._handleRouteLost=function(a){var b=this._trackedHosts[a];b&&(k.log(k.DEBUG2,"Detected %s is lost, removing affinities",a),this._handleRemove({id:Object.keys(b._affinities)},a))},d.prototype._addTrackedRecord=function(a,b,c,d){var e=this._trackedHosts[a];return e||(e=this._trackedHosts[a]={_affinities:{},_ownedCount:0,_totalCount:0}),d&&j.isExtUuid(a)&&e._ownedCount>=this._maxHostAffinities?(k.log(k.WARN,"Exceeded max affinities for host %s",a),!1):e._affinities[c]?(k.log(k.DEBUG,"We already know that affinity id %s for %s",c,a),!1):(e._affinities[c]={_concernedHost:b,_owned:!!d},e._totalCount+=1,d&&(e._totalOwned+=1),k.log(k.DEBUG2,"Added tracked affinity: [id: %s] [host: %s] [concerned host: %s]",c,a,b),!0)},d.prototype._removeTrackedRecord=function(a,b){var c=this._trackedHosts[a];if(c){var d=c._affinities[b];if(d)return k.log(k.DEBUG2,"Removed tracked affinity: [id: %s] [host: %s] [concerned host: %s]",b,a,d._concernedHost),delete c._affinities[b],c._totalCount-=1,d._owned&&(c._ownedCount-=1),d._concernedHost}return 0===c._totalCount&&delete this._trackedHosts[a],null},d.prototype._sendProtocolMessage=function(a,b,c,d,e){if("local"==a){var f=g(c)?c:[c],h=this;f.forEach(function(a){h.emit(a,b),h.removeAllListeners(a)})}else this._routerInstance.sendPacket(a,"affinity",{id:c,from:this._id,type:b,path:e},d)},d.prototype.establishHostAffinity=function(a){var b=a.toString();if(0===b.length||!a.isValid(this._maxHops))throw new Error("invalid address");var c=this._localAffinities[b];if(!c){var d=a.getPathVector();if(1==d.length&&d[0]==this._id)return null;c=this._localAffinities[b]={_id:i(),_count:0},this._handleAdd({path:a.getPathVector(),id:c._id},"local")}return c._count+=1,c._id},d.prototype.removeHostAffinity=function(a){var b=a.toString();if(0!==b.length){var c=this._localAffinities[b];c&&(c._count-=1,0===c._count&&(delete this._localAffinities[b],this._handleRemove({id:[c._id]},"local")))}}}).call(this,"/js\\app\\routing\\host-affinity.js")},{"../util/appUtils":54,"./address":36,events:65,util:85,uuid:86}],38:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(this._id=b.get("instanceId"),this._maxHops=b.get("maxHops"),this._routerInstance=a,this._routerInstance.addHandler("path"),void this._routerInstance.on("path",this._handlePathPacket.bind(this))):new d(a,b)}var e=a("util").isArray,f=a("../util/appUtils"),g=f.getLogger(c);b.exports=d,d.prototype._handlePathPacket=function(a,b){var c=a.d;if(e(c)){if(c.length>this._maxHops)return void g.log(g.ERROR,"Packet exceeds max hops (from %s), Total hops: %s",b,c.length);for(var d=this._id;d==this._id&&c.length>0;)d=c[0],c.shift();if(c.length>0){if(c.length>0){var f=this._routerInstance.getRoute(c[0]);f&&!f.external&&(d=c[0],c.shift())}this._routerInstance.sendPacket(d,"path",a,b)}else this._routerInstance.sendPacket(d,a.n,a.m,b)}},d.prototype.sendPacket=function(a,b,c){c={d:a.getPathVector(),n:b,m:c},this._handlePathPacket(c,"local")}}).call(this,"/js\\app\\routing\\path-vector.js")},{"../util/appUtils":54,util:85}],39:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this),this.setMaxListeners(0),this._id=b.get("instanceId"),this._handlers={},this._linkAssociation=b.getLinkAssociation(),this._routes={},this._routes[this._id]={adjacent:!0,nextHop:this._id,reported:!1,external:!1},this._routingTable=h(this._id),this._routingTable.on("route-update",this._handleRouteUpdate.bind(this)),this._routingTable.on("route-expired",this._handleRouteExpire.bind(this)),this._switchBoard=a,this._switchBoard.addHandler("route"),this._switchBoard.addHandler("route-update"),this._switchBoard.on("link-unavailable",this._handleLinkLost.bind(this)),this._switchBoard.on("link-switch",this._handleLinkSwitch.bind(this)),this._switchBoard.on("route",this._handleRoutePacket.bind(this)),void this._switchBoard.on("route-update",this._handleRouteUpdatePacket.bind(this))):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../util/constants"),h=a("./routing-table"),i=a("../util/appUtils"),j=i.getLogger(c);f(d,e),b.exports=d,d.prototype._handleRoutePacket=function(a,b){var c=a.d,d=this._routes[b];if(!d&&"local"!=b)return void j.log(j.WARN,"Message originated from unknown endpoint: %s",b);if(c&&c!=this._id&&"local"!=c){var e=this._routePacket(a,d,c);e||a.p&&this.hasHandler(a.p)&&this.emit(a.p+"-error",a.m,a.d,b)}else{var f=g.Neighborhood,h=f.LOCAL;d&&(h=d.external?f.UNIVERSAL:f.GROUP),a.p&&this.hasHandler(a.p)&&this.emit(a.p,a.m,b,h)}},d.prototype._handleRouteUpdatePacket=function(a,b){var c=this._routes[b];if(c&&!c.external){var d=this._routingTable.applyUpdates(b,a);this._broadcastUpdates(d)}},d.prototype._routePacket=function(a,b,c){var d=this.getRoute(c);if(!d||!d.nextHop)return j.log(j.WARN,"No route for: %s",c),!1;var e=d.nextHop;if(b&&d){if(e==b.address)return j.log(j.WARN,"Cannot route a packet back the way it came: [nextHop: %s] [from: %s]",e,b.address),!1;if((b.external||d.external)&&!this._linkAssociation.isAssociated(b.linkId,d.linkId))return j.log(j.TRACE,"Cannot route to un-bridged links [Link 1: %s] [Link 2: %s]",b.linkId,d.linkId),!0}return e==c&&delete a.d,j.log(j.TRACE,"Routing packet destined for [%s] to [%s]",c,e),this._switchBoard.sendPacket(e,"route",a),!0},d.prototype.sendPacket=function(a,b,c,d){if(this.hasHandler(b)){var e={p:b,d:a,m:c};this._handleRoutePacket(e,d||"local")}else j.log(j.WARN,"Attempted to send a packet for unregistered handler [handler: %s]",b)},d.prototype._handleRouteUpdate=function(a,b){var c=this._routes[a];if(c||(c=this._routes[a]={address:a,adjacent:a===b,nextHop:null,reported:!1,external:!1}),!c.external){c.nextHop=b;var d=this._routes[b];c.linkId=d.linkId,c.reported?(j.log(j.DEBUG2,"Updated route to [%s] reported: %s",a,b),c.adjacent=a===b,this.emit("route-change",a,c)):(j.log(j.DEBUG2,"New route to [%s] reported: %s",a,b),c.reported=!0,this.emit("route-available",a,c))}},d.prototype._handleRouteExpire=function(a){var b=this._routes[a];b&&(j.log(j.DEBUG2,"Route expired: %s",a),delete this._routes[a],this.emit("route-unavailable",a,b))},d.prototype.getRoute=function(a){if(this._routes[a])return this._routes[a]},d.prototype._handleLinkSwitch=function(a,b){var c=this._routes[a];if(c||(c=this._routes[a]={address:a,adjacent:!0,nextHop:a,reported:!1,external:b.isExternal()}),c.linkId=b.getId(),c.external)j.log(j.DEBUG2,"New external route reported: %s",a),this.emit("route-available",a,c);else{var d;d=this._routingTable.hasLink(a)?this._routingTable.updateLinkCost(a,b.getCost()):this._routingTable.addLink(a,b.getCost()),this._broadcastUpdates(d)}},d.prototype._handleLinkLost=function(a,b){var c=this._routes[a];if(c)if(c.external)this._handleRouteExpire(a);else{var d=this._routingTable.removeLink(a);this._broadcastUpdates(d)}},d.prototype._broadcastUpdates=function(a){var b=this;a.length>0&&i.nextTick(function(){j.log(j.DEBUG2,"Broadcasting router updates [Total: %s]",a.length),b._switchBoard.broadcastInternal("route-update",a)})},d.prototype.addHandler=function(a){this._handlers[a]=!0,j.log(j.DEBUG,"Added packet handler [name: %s]",a)},d.prototype.hasHandler=function(a){return!!this._handlers[a]}}).call(this,"/js\\app\\routing\\router.js")},{"../util/appUtils":54,"../util/constants":55,"./routing-table":40,events:65,util:85}],40:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this),this._links={},this._myEntry={id:a,seq:0,next:a,cost:0},this._timer=g("Routing Table",15e3),this._timer.on("period",this._performPeriodic.bind(this)),this._dests={},void(this._dests[a]=this._myEntry)):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../util/periodic-timer"),h=a("../util/appUtils"),i=h.getLogger(c);f(d,e),b.exports=d,d.prototype.getId=function(){return this._myEntry.id},d.prototype.hasLink=function(a){return!!this._links[a]},d.prototype.addLink=function(a,b){return this._links[a]?(i.log(i.WARN,"Already know about that link: [id: %s]",a),[]):(this._links[a]={cost:b},this._myEntry.seq+=2,this._dests[a]||(this._dests[a]={id:a,cost:b,seq:0,next:a}),this.emit("route-update",a,a),this._timer.addReference(),i.log(i.DEBUG2,"Added link: [id: %s]",a),this._exportTableAsUpdates())},d.prototype.updateLinkCost=function(a,b){var c=this._links[a];return c?c.cost==b?[]:(c.cost=b,this._myEntry.seq+=2,i.log(i.DEBUG2,"Updated link: [id: %s] [cost: %s]",a,b),[this._createUpdateFor(a,!1),this._createUpdateFor(this._myEntry.id,!1)]):(i.log(i.WARN,"Unknown link: [id: %s]",a),[])},d.prototype.removeLink=function(a){var b=this._links[a];if(!b)return i.log(i.WARN,"Unknown link: [id: %s]",a),[];var c=[];this._myEntry.seq+=2;for(var d in this._dests)this._dests[d].next==a&&(this._dests[d].cost=1/0,this._dests[d].seq++,c.push(this._createUpdateFor(d,!1)));return i.log(i.DEBUG2,"Removed link: [id: %s]",a),delete this._links[a],this._dests[a]&&(delete this._dests[a],this.emit("route-expired",a)),this._timer.removeReference(),c.push(this._createUpdateFor(this._myEntry.id,!1)),c},d.prototype.applyUpdates=function(a,b){var c=this._links[a];if(!c)return i.log(i.WARN,"Unknown link: %s",a),[];var d=[];i.log(i.DEBUG3,"Number of route updates in this pack: [from: %s] [count: %s]",a,b.length);for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.hasOwnProperty("id")&&f.hasOwnProperty("seq")&&f.hasOwnProperty("cost"))if("inf"==f.cost&&(f.cost=1/0),f.id!=this._myEntry.id)if(this._dests[f.id]){var g,h=f.seq>this._dests[f.id].seq;if(h||(g=f.seq==this._dests[f.id].seq&&f.cost+c.cost<this._dests[f.id].cost),h||g){var j=this._dests[f.id].next;this._dests[f.id]={id:f.id,seq:f.seq,cost:f.cost+c.cost,next:a},i.log(i.DEBUG2,"Better route encountered [id: %s] [cost: %s] [next: %s] [seq check: %s] [cost check: %s]",f.id,this._dests[f.id].cost,a,h,g),d.push(this._createUpdateFor(f.id)),f.cost===1/0&&a==j?this.emit("route-expired",f.id):this.emit("route-update",f.id,a)}else i.log(i.DEBUG3,"Non optimal route received [id: %s] [next: %s]",f.id,a)}else f.cost!==1/0?(this._dests[f.id]={id:f.id,seq:f.seq,cost:f.cost+c.cost,next:a},i.log(i.DEBUG,"Encountered new external host [id: %s] [cost: %s] [next: %s]",f.id,this._dests[f.id].cost,a),d.push(this._createUpdateFor(f.id)),this.emit("route-update",f.id,a)):i.log(i.DEBUG2,"Was sent an infinite cost route I didn't know about , ignoring [id: %s] [next: %s]",f.id,a);else if(f.seq>this._myEntry.seq){for(;f.seq>this._myEntry.seq;)this._myEntry.seq+=2;d.push(this._createUpdateFor(this._myEntry.id)),i.log(i.DEBUG3,"Someone incremented my sequence number")}else i.log(i.TRACE,"Ignore route update to myself");else i.log(i.WARN,"Malformed routing packet: %j",f)}return d},d.prototype._exportTableAsUpdates=function(a){var b=[];for(var c in this._dests)b.push(this._createUpdateFor(c,a));return b},d.prototype._createUpdateFor=function(a,b){var c=this._dests[a];if(c){var d={id:a,seq:c.seq,cost:c.cost};return d.cost===1/0&&(d.cost="inf"),b&&(d.next=c.next),d}return null},d.prototype._performPeriodic=function(a){var b=[];i.log(i.DEBUG3,"Periodic routing table cleanup");for(var c in this._dests)if(a)c!=this._myEntry.id&&b.push(c);else{var d=this._dests[c];d.cost==1/0&&(d.ttl?d.ttl>=1?b.push(c):d.ttl++:d.ttl=1)}b.length>0&&(i.log(i.DEBUG,"Deleting %s items from the routing table",b.length),b.forEach(function(a){delete this._dests[a],this.emit("route-expired",a)},this))}}).call(this,"/js\\app\\routing\\routing-table.js")},{"../util/appUtils":54,"../util/periodic-timer":58,events:65,util:85}],41:[function(a,b,c){(function(c){"use strict";function d(a,b){b=b||2e4;var c,d=0,e=0,f=h("Heart Beat",b),i=!1,k=j.obj(function(a,b,c){this.push({m:a}),e+=1,c()});return a.on("read",function(){d+=1}),a.on("heartbeat-timeout",function(){k.emit("heartbeat-timeout")}),a.on("read-close",function(){f.removeReference()}),f.on("period",function(b){if(!b){if(g.log(g.DEBUG3,"Periodic timer [id: %s] [read counter: %s] [send counter: %s] [waiting for ping: %s] ",c,d,e,i),0===d){if(i)return g.log(g.WARN,"Heartbeat detected stream link is dead"),void a.emit("heartbeat-timeout");i=!0}else d=0,i=!1;0===e?k.push({h:"ping"}):e=0}}),k.on("finish",function(){f.removeReference()}),c=f.addReference(),k}function e(a){var b=j.obj(function(b,c,d){b.h||this.push(b.m),a.emit("read"),d()});return b.on("finish",function(){a.emit("read-close")}),a.on("heartbeat-timeout",function(){b.emit("heartbeat-timeout")}),b}var f=a("../util/appUtils"),g=f.getLogger(c),h=a("../util/periodic-timer"),i=a("events").EventEmitter,j=a("through2");b.exports=function(a){var b=new i,c={encode:d(b,a),decode:e(b)};return c}}).call(this,"/js\\app\\streams\\heartbeat-stream.js")},{"../util/appUtils":54,"../util/periodic-timer":58,events:65,through2:81}],42:[function(a,b,c){(function(c){"use strict";function d(a,b){function c(){if(!e._closed&&(e._sendTransport.push(null),e._sendTransport.end(),e._closed=!0,e._cb)){var a=e._cb;e._cb=null,a()}}if(!(this instanceof d))return new d(a,b);b=b||{},f.call(this,b),this._cb=null,this._closed=!1;var e=this;this.on("finish",function(){h.log(h.DEBUG2,"Link stream finish detected"),c()}),this.on("end",function(){h.log(h.DEBUG2,"Link stream end detected"),c()}),this.setStreams(a)}var e=a("util").inherits,f=a("readable-stream").Duplex,g=a("../util/appUtils"),h=g.getLogger(c);e(d,f),b.exports=d,d.prototype._read=function(a){this.emit("back-pressure-relieved")},d.prototype._write=function(a,b,c){this._closed?(h.log(h.DEBUG3,"Writing to a stream that is closed: %j",a),c()):this._sendTransport.write(a)?c():this._cb=c},d.prototype.getStreams=function(){return{readTransport:this._readTransport,sendTransport:this._sendTransport}},d.prototype.setStreams=function(a){function b(){var a=g._readTransport.read();if(a){var b=g.push(a);b||g.emit("back-pressure")}}function c(){i||(g.push(null),g.end(),i=!0)}function d(){h.log(h.DEBUG2,"Transport read end detected"),c()}function e(){h.log(h.DEBUG2,"Transport read finish detected"),c()}function f(){if(h.log(h.DEBUG3,"Transport write drain detected"),g._cb){var a=g._cb;g._cb=null,a()}}this._readTransport&&(this._readTransport.removeListener("readable",b),this._readTransport.removeListener("end",d),this._readTransport.removeListener("finish",e)),
this._sendTransport&&this._readTransport.removeListener("drain",f),this._readTransport=a.readTransport,this._sendTransport=a.sendTransport;var g=this;this._readTransport.on("readable",b),this._readTransport.on("end",d),this._readTransport.on("finish",e);var i=!1;this._sendTransport.on("drain",f)}}).call(this,"/js\\app\\streams\\link-stream.js")},{"../util/appUtils":54,"readable-stream":78,util:85}],43:[function(a,b,c){"use strict";var d=a("through2");b.exports={},b.exports.encodeMetaWrapStream=function(a){if(a){var b=d.obj(function(b,c,d){this.push({meta:a,m:b}),d()});return b.updateMeta=function(b){a=b},b}return d.obj(function(a,b,c){this.push({m:a}),c()})},b.exports.decodeMetaWrapStream=function(){return d.obj(function(a,b,c){this.push(a.m),c()})}},{through2:81}],44:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(this._streams={},a=a||{},this._opts=a,this.on("end",function(){this.close()}.bind(this)),this.on("finish",function(){this.close()}.bind(this)),e.call(this,{objectMode:!0}),void this.setMaxListeners(0)):new d(a)}var e=a("readable-stream").Transform,f=a("./link-stream"),g=a("util").inherits,h=a("uuid"),i=a("through2"),j=a("xtend"),k=a("../util/appUtils"),l=k.getLogger(c);g(d,e),b.exports=d,d.prototype.createStream=function(a,b,c){c=c||h(),b=b||{};var d=this._createStream(a,b,c),e={meta:a,opts:{objectMode:!!b.hasOwnProperty("objectMode")&&b.objectMode}};return this._sendProtocol(c,"new",e),d},d.prototype._createStream=function(a,b,c){function d(){n||(m.receivedEnd||o._sendProtocol(c,"end"),h.unpipe(),m.read.end(),m.read.push(null),delete o._streams[c],n=!0)}if(this._streams[c]){var e=new Error("That stream already exists");throw l.log(l.ERROR,e.message),e}var g=i.obj(function(a,b,c){this.push(a),m.backPressure?m.backPressureCB=c:c()}),h=i.obj(function(a,b,d){a={m:a},a.local=!0,a.id=c,this.push(a),d()}),j=i.obj(function(a,b,c){this.push(a.m),c()});g.pipe(h),h.pipe(this,{end:!1});var k=f({readTransport:j,sendTransport:g},b);k.id=c;var m=this._streams[c]={id:c,read:j,write:h,meta:a,linkStream:k,backPressure:!1,backPressureCB:null,receivedEnd:!1,flowing:!0},n=!1,o=this;return k.on("end",d.bind(this)),k.on("finish",d.bind(this)),k.on("back-pressure",function(){m.flowing&&(this._sendProtocol(c,"pause"),m.flowing=!1)}.bind(this)),k.on("back-pressure-relieved",function(){m.flowing||(this._sendProtocol(c,"resume"),m.flowing=!0)}.bind(this)),l.log(l.TRACE,"Created stream: %s",c),k},d.prototype._transform=function(a,b,c){if(a.local)delete a.local,l.log(l.TRACE,"Sending message: %j",a),this.push(a);else{l.log(l.TRACE,"Received message: %j",a);var d=this._streams[a.id];a.m&&a.m.p?this._handleProtocol(d,a):d?d.read.write(a):l.log(l.ERROR,"Unknown stream: %s",a.id)}c()},d.prototype._handleProtocol=function(a,b){if(l.log(l.DEBUG3,"Received protocol message: [msg: %s] [id: %s]",b.m.p,b.id),a)switch(b.m.p){case"new":l.log(l.ERROR,"That stream is already open: %s",b.id),a.linkStream.end();break;case"error":a.linkStream.end();break;case"end":a.receivedEnd=!0,a.linkStream.end();break;case"pause":a.backPressure=!0;break;case"resume":if(a.backPressure=!1,a.backPressureCB){var c=a.backPressureCB;a.backPressureCB=null,c()}}else if("new"==b.m.p){var d=b.m.meta.meta,e=b.m.meta.opts,f=e.objectMode,g=j(this._opts,{objectMode:f}),h=this._createStream(null,g,b.id);h.meta=d,this.emit("stream",h,g)}},d.prototype._sendProtocol=function(a,b,c){var d=this._streams[a];d||l.log(l.ERROR,"Unknown stream: %s",a),l.log(l.DEBUG3,"Sending protocol message: [msg: %s] [id: %s]",b,a),c=c||{},d.write.write({p:b,meta:c})},d.prototype.getStream=function(a){var b=null;return this._streams[a]&&(b=this._streams[a].linkStream),b},d.prototype.updateStreamMeta=function(a,b){this._streams[a]?this._streams[a].meta=b:l.log(l.WARN,"Can't update meta for stream I don't know about: %s",a)},d.prototype.getStreamMeta=function(a){var b=null;return this._streams[a]&&(b=this._streams[a].meta),b},d.prototype.close=function(){var a=Object.keys(this._streams);a.forEach(function(a){this._streams[a].linkStream.end()},this)}}).call(this,"/js\\app\\streams\\mux-stream.js")},{"../util/appUtils":54,"./link-stream":42,"readable-stream":78,through2:81,util:85,uuid:86,xtend:91}],45:[function(a,b,c){"use strict";function d(a,b,c){var e=c(a,b);if(b!==e)return e;if(e&&"object"==typeof e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&e[f]&&(e[f]=d(f,e[f],c));return b}var e=a("through2"),f=a("util").isBuffer,g=a("buffer").Buffer;b.exports={},b.exports.encode=function(a){return e.obj(function(c,d,e){this.push(b.exports.encodeFunction(a,c)),e()})},b.exports.encodeFunction=function(a,b){var c;if(a)b=d("",b,function(a,b){return(b._isBuffer||f(b))&&(b={type:"buffer-i",data:b.toString("base64")}),b}),c=JSON.stringify(b);else{var e=[],g=0;b=d("",b,function(a,c){if(b._isBuffer||f(c)){var d={type:"buffer-o",index:g++};return c=c.toArrayBuffer?c.toArrayBuffer():c.buffer,e.push(c),d}return c}),c=JSON.stringify(b),c={data:c,transfer:e}}return c},b.exports.decode=function(a){return e.obj(function(c,d,e){this.push(b.exports.decodeFunction(a,c)),e()})},b.exports.decodeFunction=function(a,b){var c;return a?(c=JSON.parse(b),c=d("",c,function(a,b){return b&&"buffer-i"==b.type?new g(b.data,"base64"):b})):(c=JSON.parse(b.data),c=d("",c,function(a,c){return c&&"buffer-o"==c.type?new g(b.transfer[c.index]):c})),c}},{buffer:63,through2:81,util:85}],46:[function(a,b,c){(function(c){"use strict";function d(a){return this instanceof d?(e.call(this),this._links={},this._expiredEdges=g(60,"Link Directory"),this._externalEdges={},a=a||{},a.hasOwnProperty("objectMode")||(a.objectMode=!0),void(this._opts=a)):new d(a)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("../util/expirable-hash"),h=a("./link-transform"),i=a("../util/appUtils"),j=i.getLogger(c);f(d,e),b.exports=d,d.prototype._handleConnection=function(a,b,c){j.log(j.INFO,"New connection for: [fromUuid: %s] [Link Type: %s] [External: %s] [Link Id: %s]",b,a.getType(),a.isExternal(),a.getId());var d=a.getHeartbeatTimeout(),e=h(this._opts,c.read,c.write,d),f=a.getTransformFactory();"function"==typeof f&&f(e);var g=e.getLinkStream();if(a.isExternal()){if(this._externalEdges[b]||this._expiredEdges.get(b))return j.log(j.WARN,"Host attempted to use the same external vertex id: %s",b),void g.end();this._externalEdges[b]=!0,b+="-ext"}this.emit("connection",a,b,g)},d.prototype._handleConnectionClose=function(a,b){if(j.log(j.INFO,"Closed connection: [fromUuid: %s] [Link Type: %s] [External: %s] [Link Id: %s]",b,a.getType(),a.isExternal(),a.getId()),a.isExternal()){if(!this._externalEdges[b])return;this._expiredEdges.add(b,!0),b+="-ext"}this.emit("connection-close",a,b)},d.prototype.hasLink=function(a){return!!this._links[a]},d.prototype.getLink=function(a){return this.hasLink(a)?this._links[a]._link:null},d.prototype.addLink=function(a){if(this.hasLink(a.getId()))throw new Error("Link already registered");var b=this._links[a.getId()]={_link:a,_connectionPtr:this._handleConnection.bind(this),_connectionClosePtr:this._handleConnectionClose.bind(this)};a.on("connection",b._connectionPtr),a.on("connection-close",b._connectionClosePtr),j.log(j.DEBUG,"Added link: [Link Type: %s] [External: %s] [Link ID: %s]",a.getType(),a.isExternal(),a.getId())},d.prototype.removeLink=function(a){if(this.hasLink(a.getId())){var b=this._links[a.getId()];b._link.close(),b._link.removeListener("connection",b._connectionPtr),b._link.removeListener("connection-close",b._connectionClosePtr),delete this._links[b._link.getId()],j.log(j.DEBUG,"Removed link: [Link Type: %s] [Link ID: %s]",b._link.getType(),b._link.getId())}},d.prototype.close=function(){var a=Object.keys(this._links);a.forEach(function(a){this.removeLink(this.getLink(a))},this)}}).call(this,"/js\\app\\switching\\link-directory.js")},{"../util/appUtils":54,"../util/expirable-hash":56,"./link-transform":47,events:65,util:85}],47:[function(a,b,c){"use strict";function d(a,b,c,f){if(!(this instanceof d))return new d(a,b,c,f);this._opts=a,this._readStream=b,this._writeStream=c;var i=g.decodeMetaWrapStream();b.pipe(i);var j=g.encodeMetaWrapStream();j.pipe(c),f&&(f=Math.floor(f/2));var k=h(f),l=k.encode,m=k.decode;l.pipe(j),i.pipe(m);var n=this._linkStream=e({readTransport:m,sendTransport:l},a);l.on("heartbeat-timeout",function(){n.end()})}var e=a("../streams/link-stream"),f=a("through2"),g=a("../streams/metawrap-stream"),h=a("../streams/heartbeat-stream");b.exports=d,d.prototype.getLinkStream=function(){return this._linkStream},d.prototype.addTransform=function(a,b){var c=this._linkStream.getStreams();a=a||f.obj(),b=b||f.obj(),"function"==typeof a&&(a=f.obj(a)),"function"==typeof b&&(b=f.obj(b)),b.pipe(c.sendTransport),c.readTransport.pipe(a),this._linkStream.setStreams({readTransport:a,sendTransport:b})}},{"../streams/heartbeat-stream":41,"../streams/link-stream":42,"../streams/metawrap-stream":43,through2:81}],48:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(e.call(this),this._id=b.get("instanceId"),this._handlers={},this._endpoints={},this._linkDirectory=a,this._linkDirectory.on("connection",this._handleConnection.bind(this)),void this._linkDirectory.on("connection-close",this._handleConnectionClose.bind(this))):new d(a,b)}var e=a("events").EventEmitter,f=a("util").inherits,g=a("./switch-stream"),h=a("../util/appUtils"),i=h.getLogger(c);f(d,e),b.exports=d,d.prototype._handleConnection=function(a,b,c){var d=this.getEndpoint(b);if(!d){if("local"==b||b==this._id)return i.log(i.ERROR,"Reserved link name used: local"),void c.end();this._endpoints[b]=d={switchStream:g({objectMode:!0}),activeLink:a,streams:{}};var e=this;d.switchStream.on("readable",function(){for(var a;null!==(a=d.switchStream.read());)e._handleRawInbound(b,a)}),d.switchStream.on("switch",function(a,c){d.activeLink=c,e.emit("link-switch",b,c)}),this.emit("link-available",b,a),i.log(i.DEBUG2,"Creating endpoint: %s",b)}d.streams[a.getId()]?(i.log(i.WARN,"Received a duplicate connection from [link: %s] for [host: %s]; closing it!",a.getId(),b),c.end()):(d.streams[a.getId()]=c,d.switchStream.addStream(c,a.getCost(),a))},d.prototype._handleConnectionClose=function(a,b){if("local"==b||b==this._id)return void i.log(i.ERROR,"Reserved link name used: local");if(!this.hasEndpoint(b))throw i.log(i.ERROR,"The given endpoint does not exist: %s",b),new Error("The given endpoint does not exist: "+b);var c=this.getEndpoint(b);c.switchStream.removeStream(c.streams[a.getId()]),delete c.streams[a.getId()],0===c.switchStream.getNumberStreams()&&(i.log(i.DEBUG2,"Removing endpoint: %s",b),c.switchStream.end(),delete this._endpoints[b],this.emit("link-unavailable",b,a))},d.prototype._handleRawInbound=function(a,b){b.p&&this.hasHandler(b.p)?this.emit(b.p,b.m,a):i.log(i.ERROR,"Unknown packet type: [type: %s]",b.p)},d.prototype.sendPacket=function(a,b,c){if(this.hasHandler(b)&&this.hasEndpoint(a)){var d=this.getEndpoint(a),e={p:b,m:c};d.switchStream.write(e)}else i.log(i.WARN,"Attempted to send a packet to unregistered handler or endpoint [handler: %s] [endpoint: %s]",b,a)},d.prototype.broadcastInternal=function(a,b){for(var c in this._endpoints){var d=this.getEndpoint(c);d.activeLink.isExternal()||this.sendPacket(c,a,b)}},d.prototype.addHandler=function(a){this._handlers[a]=!0,i.log(i.DEBUG,"Added packet handler [name: %s]",a)},d.prototype.hasHandler=function(a){return!!this._handlers[a]},d.prototype.getEndpoint=function(a){var b=this._endpoints[a];return b},d.prototype.getLinkDirectory=function(){return this._linkDirectory},d.prototype.hasEndpoint=function(a){return!!this._endpoints[a]}}).call(this,"/js\\app\\switching\\switch-board.js")},{"../util/appUtils":54,"./switch-stream":49,events:65,util:85}],49:[function(a,b,c){(function(c){"use strict";var d=a("../util/appUtils"),e=d.getLogger(c),f=a("../streams/link-stream"),g=a("through2");b.exports=function(a){function b(){var a=null;d.forEach(function(b){(null===a||b.cost<=a.cost)&&(a=b)}),c!==a&&(null!==c&&(e.log(e.DEBUG3,"Un-piping myself from existing stream"),i.unpipe(c.stream),c=null),null!==a?(e.log(e.DEBUG2,"Lower cost stream selected [new: %s]",a.cost),c=a,i.pipe(c.stream,{end:!1}),j.emit("switch",a.cost,a.meta)):j.emit("switch-close"))}var c=null,d=[],h=g.obj(),i=g.obj(function(a,b,d){if(null===c)throw e.log(e.ERROR,"No writable stream to pipe to!"),new Error("No writable stream");this.push(a),d()}),j=f({readTransport:h,sendTransport:i},a);return j.addStream=function(a,c,f){d.push({stream:a,cost:c,meta:f}),a.pipe(h,{end:!1}),b(),e.log(e.DEBUG2,"Added stream to switch-stream [total: %s]",d.length)},j.removeStream=function(a){for(var c=d.length-1;c>0&&d[c].stream!==a;c--);c>=0?(d.splice(c,1),a.unpipe(h),b(),e.log(e.DEBUG2,"Removed stream from switch-stream [total: %s]",d.length)):e.log(e.WARN,"Tried to remove a stream from this switch-stream but that stream is not registered")},j.getNumberStreams=function(){return d.length},j}}).call(this,"/js\\app\\switching\\switch-stream.js")},{"../streams/link-stream":42,"../util/appUtils":54,through2:81}],50:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(a=a||{},b=b||{},b.objectMode=!0,e.call(this,b),this._channel=a.channel||"local-channel",this._localStorage=null,this._globalObject=g.getGlobalObject(),this._storageEventPtr=this._storageEvent.bind(this),this._localStorage=this._globalObject.localStorage,this.on("finish",function(){h.log(h.DEBUG2,"Destructed LocalStorageTransport: [Channel: %s]",this._channel),this.close()}.bind(this)),g.addEventListener(this._globalObject,"storage",this._storageEventPtr,!1),void h.log(h.DEBUG2,"Initialized LocalStorageTransport: [Channel: %s]",this._channel)):new d(a,b)}var e=a("readable-stream").Duplex,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype._read=function(a){},d.prototype._storageEvent=function(a){a.key===this._channel&&(h.log(h.TRACE,"Received message: [%s]",a.newValue),this.push(a.newValue))},d.prototype._write=function(a,b,c){h.log(h.TRACE,"Sending message: [%s]",a),this._localStorage.setItem(this._channel,a),c()},d.prototype.close=function(){g.removeEventListener(this._globalObject,"storage",this._storageEventPtr),this.end()}}).call(this,"/js\\app\\transport\\localstorage.js")},{"../util/appUtils":54,"readable-stream":78,util:85}],51:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(a=a||{},b=b||{},b.objectMode=!0,e.call(this,b),this._target=a.target,this._origin=a.origin||"",this._preserveSource=!!a.hasOwnProperty("preserveSource")&&a.preserveSource,this._checkOrigin="undefined"==typeof a.checkOrigin||a.checkOrigin,this._messageEventPtr=this._messageEvent.bind(this),g.addEventListener(this._target,"message",this._messageEventPtr),this.on("end",function(){h.log(h.DEBUG2,"Destructed PostMessageReaderTransport"),this.close()}.bind(this)),void h.log(h.DEBUG2,"Initialized PostMessageReaderTransport: [Origin: %s] [Check Origin: %s]",this._origin,this._checkOrigin)):new d(a,b)}var e=a("readable-stream").Readable,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype._read=function(a){},d.prototype._messageEvent=function(a){return this._checkOrigin&&this._origin!==a.origin?void h.log(h.DEBUG3,"Received message from invalid origin: [Origin: %s] [Expected Origin: %s] [Message: %j]",a.origin,this._origin,a.data):(h.log(h.TRACE,"Received message: [%s]",a.data),void(this._preserveSource?this.push({source:a.source,origin:a.origin,msg:a.data}):this.push(a.data)))},d.prototype.close=function(){g.removeEventListener(this._target,"message",this._messageEventPtr),this.push(null)}}).call(this,"/js\\app\\transport\\postmessage-reader.js")},{"../util/appUtils":54,"readable-stream":78,util:85}],52:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(a=a||{},b=b||{},b.objectMode=!0,e.call(this,b),this._target=a.target,this._origin=a.origin||"",this._sendOrigin=!a.hasOwnProperty("sendOrigin")||a.sendOrigin,void h.log(h.DEBUG2,"Initialized PostMessageSenderTransport: [Origin: %s] [Send Origin: %s]",this._origin,this._sendOrigin)):new d(a,b)}var e=a("readable-stream").Writable,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype._write=function(a,b,c){h.log(h.TRACE,"Sending message: [%s]",a),this._sendOrigin?this._target.postMessage(a,this._origin):this._target.postMessage(a),c()}}).call(this,"/js\\app\\transport\\postmessage-sender.js")},{"../util/appUtils":54,"readable-stream":78,util:85}],53:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);a=a||{},b=b||{},b.objectMode=!0,e.call(this,b),this._channel=a.channel,this._target=a.target,this._dataEventPtr=this._handleDataEvent.bind(this),this._target.on(this._channel,this._dataEventPtr);var c=this,f=function(){null!==c._target&&(h.log(h.DEBUG2,"Destructed SocketIoTransport: [Channel: %s]",c._channel),c._target.removeListener(c._channel,c._dataEventPtr),c._target=null)};this.on("end",f),this.on("finish",f);var g=function(){c.push(null)};this._target.on("disconnect",g),h.log(h.DEBUG2,"Initialized SocketIoTransport: [Channel: %s]",this._channel)}var e=a("readable-stream").Duplex,f=a("util").inherits,g=a("../util/appUtils"),h=g.getLogger(c);f(d,e),b.exports=d,d.prototype._read=function(a){},d.prototype._handleDataEvent=function(a){h.log(h.TRACE,"Received message: [%j]",a),this.push(a)},d.prototype._write=function(a,b,c){h.log(h.TRACE,"Sending message: [%j]",a),null!==this._target&&this._target.emit(this._channel,a),c()},d.prototype.close=function(){this._target.disconnect()}}).call(this,"/js\\app\\transport\\socketio.js")},{"../util/appUtils":54,"readable-stream":78,util:85}],54:[function(a,b,c){(function(c,d){"use strict";var e=a("./logger").Logger,f=a("./constants"),g=a("util").isString,h={_scriptName:null,initScriptName:function(){if(!this._scriptName){var a=this.getGlobalObject();if(a.document){var b=a.document.getElementsByTagName("script"),c=b[b.length-1];this._scriptName=c.src}}},isUuid:function(a){return!(!g(a)||36!=a.length)},isExtUuid:function(a){return!(!g(a)||40!=a.length||36!==a.indexOf("-ext"))},getScriptName:function(){return this._scriptName},getGlobalObject:function(){return d},nextTick:function(a){c.nextTick(a)},getScriptBasename:function(a){if(a&&"string"==typeof a&&("/"==a[0]||"\\"==a[0])){a=a.replace(/\\/g,"/");var b=a.split("/");a=b[b.length-1]}return a},getLogger:function(a){return e(this.getScriptBasename(a))},addEventListener:function(a,b,c,d){"addEventListener"in a?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)},removeEventListener:function(a,b,c,d){"removeEventListener"in a?a.removeEventListener(b,c,d):a.detachEvent("on"+b,c)},getNeighborhood:function(a,b){var c=f.Neighborhood[(b+"").toUpperCase()],d=f.Neighborhood[(a+"").toUpperCase()];return"undefined"==typeof d?c:d}};b.exports=h}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./constants":55,"./logger":57,_process:71,util:85}],55:[function(a,b,c){"use strict";b.exports={EndpointType:{CLIENT:"Client",CLIENT_INSTANCE:"Client Instance",FACADE:"Facade",ADAPTER:"Adapter",OBJECT_INSTANCE:"Object Instance",CALL:"Call",QUERY:"Query"},LinkType:{SERVER:"server",WORKER:"worker",TAB:"tab",WINDOW:"window"},Neighborhood:{UNIVERSAL:3,GLOBAL:2,GROUP:1,LOCAL:0}}},{}],56:[function(a,b,c){"use strict";function d(a,b){return this instanceof d?(g.call(this),this._duration=1e3*a,this._items=0,this._itemsArray=[],this._itemsHash={},this._timer=e(b||"Expirable Hash",this._duration),void this._timer.on("period",this._check.bind(this))):new d(a,b)}var e=a("./periodic-timer"),f=a("util").inherits,g=a("events").EventEmitter;f(d,g),b.exports=d,d.prototype.add=function(a,b){this._clean(),this.remove(a);var c={k:a,v:b,t:(new Date).getTime()+this._duration};this._items+=1,this._itemsArray.push(c),this._itemsHash[a]=c,this._timer.addReference()},d.prototype.get=function(a){this._check();var b=this._itemsHash[a];if(b)return b.v},d.prototype.touch=function(a){var b=this.get(a);b&&(this.remove(a),this.add(a,b))},d.prototype.remove=function(a){var b=this._itemsHash[a];b&&(this._items-=1,b.v=b.k=null,b.t=0,delete this._itemsHash[a],this._timer.removeReference())},d.prototype._check=function(){for(var a=(new Date).getTime();this._itemsArray.length>0;){var b=this._itemsArray[0];if(b.t>a)break;b.t>0&&(this.emit("expired",b.k,b.v),this.remove(b.k)),this._itemsArray.shift()}},d.prototype._clean=function(){if(this._itemsArray.length>10&&this._itemsArray.length>2*this._items){var a=[];this._itemsArray.forEach(function(b){b.t>0&&a.push(b)}),this._itemsArray=a}}},{"./periodic-timer":58,events:65,util:85}],57:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);a=a||"Unknown";var b="Unknown";"string"==typeof a?b=a:"object"==typeof a&&a.constructor&&(b=a.constructor.name),this._location=a}var e=a("util").format;b.exports={Logger:d,logLevel:"warn"},d.prototype.TRACE="trace",d.prototype.DEBUG3="debug3",d.prototype.DEBUG2="debug2",d.prototype.DEBUG="debug",d.prototype.INFO="info",d.prototype.WARN="warn",d.prototype.ERROR="error",d.prototype.NONE="none",d.prototype._LevelPriority={trace:8,debug3:7,debug2:6,debug:5,info:4,warn:3,error:2,none:1},d.prototype._ConsoleMap={trace:"debug",debug3:"debug",debug2:"debug",debug:"debug",info:"info",warn:"warn",error:"error"},d.prototype.log=function(a,c){if("undefined"!=typeof console){this._LevelPriority[a]||(a=this.DEBUG);var d=this._LevelPriority[b.exports.logLevel],f=this._LevelPriority[a];if(f<=d){if(arguments.length>2){var g=Array.prototype.slice.call(arguments,2);g.unshift(c),c=e.apply(e,g)}var h=new Date,i=e("%s:%s:%s - [%s] [%s] %s",h.getHours(),h.getMinutes(),h.getSeconds(),a,this._location,c);"function"==typeof console[this._ConsoleMap[a]]?console[this._ConsoleMap[a]](i):console.log(i)}}}},{util:85}],58:[function(a,b,c){(function(c){"use strict";function d(a,b){return this instanceof d?(h.call(this),this._name=a,this._timeout=b||15e3,this._references=0,void(this._timerId=null)):new d(a,b)}var e=a("../util/appUtils"),f=e.getLogger(c),g=a("util").inherits,h=a("events").EventEmitter;g(d,h),b.exports=d,d.prototype.getReferenceCounter=function(){return this._references},d.prototype.addReference=function(){return this._references++,this._checkTimer()},d.prototype.removeReference=function(){return this._references--,this._checkTimer()},d.prototype._checkTimer=function(){var a=this._timerId;return 0===this._references&&null!==this._timerId?(f.log(f.DEBUG2,"Stopping [%s] interval timer: %s",this._name,this._timerId),clearInterval(this._timerId),this._timerId=null,this.emit("period",!0)):this._references>0&&null===this._timerId&&(this._timerId=setInterval(function(){this.emit("period")}.bind(this),this._timeout),f.log(f.DEBUG2,"Starting [%s] interval timer: %s",this._name,this._timerId),a=this._timerId),a}}).call(this,"/js\\app\\util\\periodic-timer.js")},{"../util/appUtils":54,events:65,util:85}],59:[function(a,b,c){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);c<e;){if(c in d&&d[c]===a)return c;c++}return-1}),"undefined"!=typeof window&&window.location&&!window.location.origin&&(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},{}],60:[function(a,b,c){"use strict";function d(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function e(a){return 3*a.length/4-d(a)}function f(a){var b,c,e,f,g,h,i=a.length;g=d(a),h=new l(3*i/4-g),e=g>0?i-4:i;var j=0;for(b=0,c=0;b<e;b+=4,c+=3)f=k[a.charCodeAt(b)]<<18|k[a.charCodeAt(b+1)]<<12|k[a.charCodeAt(b+2)]<<6|k[a.charCodeAt(b+3)],h[j++]=f>>16&255,h[j++]=f>>8&255,h[j++]=255&f;return 2===g?(f=k[a.charCodeAt(b)]<<2|k[a.charCodeAt(b+1)]>>4,h[j++]=255&f):1===g&&(f=k[a.charCodeAt(b)]<<10|k[a.charCodeAt(b+1)]<<4|k[a.charCodeAt(b+2)]>>2,h[j++]=f>>8&255,h[j++]=255&f),h}function g(a){return j[a>>18&63]+j[a>>12&63]+j[a>>6&63]+j[63&a]}function h(a,b,c){for(var d,e=[],f=b;f<c;f+=3)d=(a[f]<<16)+(a[f+1]<<8)+a[f+2],e.push(g(d));return e.join("")}function i(a){for(var b,c=a.length,d=c%3,e="",f=[],g=16383,i=0,k=c-d;i<k;i+=g)f.push(h(a,i,i+g>k?k:i+g));return 1===d?(b=a[c-1],e+=j[b>>2],e+=j[b<<4&63],e+="=="):2===d&&(b=(a[c-2]<<8)+a[c-1],e+=j[b>>10],e+=j[b>>4&63],e+=j[b<<2&63],e+="="),f.push(e),f.join("")}c.byteLength=e,c.toByteArray=f,c.fromByteArray=i;for(var j=[],k=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=m.length;n<o;++n)j[n]=m[n],k[m.charCodeAt(n)]=n;k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},{}],61:[function(a,b,c){},{}],62:[function(a,b,c){(function(b){"use strict";var d=a("buffer"),e=d.Buffer,f=d.SlowBuffer,g=d.kMaxLength||2147483647;c.alloc=function(a,b,c){if("function"==typeof e.alloc)return e.alloc(a,b,c);if("number"==typeof c)throw new TypeError("encoding must not be number");if("number"!=typeof a)throw new TypeError("size must be a number");if(a>g)throw new RangeError("size is too large");var d=c,f=b;void 0===f&&(d=void 0,f=0);var h=new e(a);if("string"==typeof f)for(var i=new e(f,d),j=i.length,k=-1;++k<a;)h[k]=i[k%j];else h.fill(f);return h},c.allocUnsafe=function(a){if("function"==typeof e.allocUnsafe)return e.allocUnsafe(a);if("number"!=typeof a)throw new TypeError("size must be a number");if(a>g)throw new RangeError("size is too large");return new e(a)},c.from=function(a,c,d){if("function"==typeof e.from&&(!b.Uint8Array||Uint8Array.from!==e.from))return e.from(a,c,d);if("number"==typeof a)throw new TypeError('"value" argument must not be a number');if("string"==typeof a)return new e(a,c);if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer){var f=c;if(1===arguments.length)return new e(a);"undefined"==typeof f&&(f=0);var g=d;if("undefined"==typeof g&&(g=a.byteLength-f),f>=a.byteLength)throw new RangeError("'offset' is out of bounds");if(g>a.byteLength-f)throw new RangeError("'length' is out of bounds");return new e(a.slice(f,f+g))}if(e.isBuffer(a)){var h=new e(a.length);return a.copy(h,0,0,a.length),h}if(a){if(Array.isArray(a)||"undefined"!=typeof ArrayBuffer&&a.buffer instanceof ArrayBuffer||"length"in a)return new e(a);if("Buffer"===a.type&&Array.isArray(a.data))return new e(a.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},c.allocUnsafeSlow=function(a){if("function"==typeof e.allocUnsafeSlow)return e.allocUnsafeSlow(a);if("number"!=typeof a)throw new TypeError("size must be a number");if(a>=g)throw new RangeError("size is too large");return new f(a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:63}],63:[function(a,b,c){(function(b){"use strict";function d(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()&&"function"==typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(a){return!1}}function e(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a,b){if(e()<b)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(b),a.__proto__=g.prototype):(null===a&&(a=new g(b)),a.length=b),a}function g(a,b,c){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(a,b,c);if("number"==typeof a){if("string"==typeof b)throw new Error("If encoding is specified then the first argument must be a string");return k(this,a)}return h(this,a,b,c)}function h(a,b,c,d){if("number"==typeof b)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer?n(a,b,c,d):"string"==typeof b?l(a,b,c):o(a,b)}function i(a){if("number"!=typeof a)throw new TypeError('"size" argument must be a number');if(a<0)throw new RangeError('"size" argument must not be negative')}function j(a,b,c,d){return i(b),b<=0?f(a,b):void 0!==c?"string"==typeof d?f(a,b).fill(c,d):f(a,b).fill(c):f(a,b)}function k(a,b){if(i(b),a=f(a,b<0?0:0|p(b)),!g.TYPED_ARRAY_SUPPORT)for(var c=0;c<b;++c)a[c]=0;return a}function l(a,b,c){if("string"==typeof c&&""!==c||(c="utf8"),!g.isEncoding(c))throw new TypeError('"encoding" must be a valid string encoding');var d=0|r(b,c);a=f(a,d);var e=a.write(b,c);return e!==d&&(a=a.slice(0,e)),a}function m(a,b){var c=b.length<0?0:0|p(b.length);a=f(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function n(a,b,c,d){if(b.byteLength,c<0||b.byteLength<c)throw new RangeError("'offset' is out of bounds");if(b.byteLength<c+(d||0))throw new RangeError("'length' is out of bounds");return b=void 0===c&&void 0===d?new Uint8Array(b):void 0===d?new Uint8Array(b,c):new Uint8Array(b,c,d),g.TYPED_ARRAY_SUPPORT?(a=b,a.__proto__=g.prototype):a=m(a,b),a}function o(a,b){if(g.isBuffer(b)){var c=0|p(b.length);return a=f(a,c),0===a.length?a:(b.copy(a,0,0,c),a)}if(b){if("undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer||"length"in b)return"number"!=typeof b.length||Y(b.length)?f(a,0):m(a,b);if("Buffer"===b.type&&_(b.data))return m(a,b.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function q(a){return+a!=a&&(a=0),g.alloc(+a)}function r(a,b){if(g.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return T(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return W(a).length;default:if(d)return T(a).length;b=(""+b).toLowerCase(),d=!0}}function s(a,b,c){var d=!1;if((void 0===b||b<0)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),c<=0)return"";if(c>>>=0,b>>>=0,c<=b)return"";for(a||(a="utf8");;)switch(a){case"hex":return H(this,b,c);case"utf8":case"utf-8":return D(this,b,c);case"ascii":return F(this,b,c);case"latin1":case"binary":return G(this,b,c);case"base64":return C(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,b,c);default:
if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function u(a,b,c,d,e){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,isNaN(c)&&(c=e?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(e)return-1;c=a.length-1}else if(c<0){if(!e)return-1;c=0}if("string"==typeof b&&(b=g.from(b,d)),g.isBuffer(b))return 0===b.length?-1:v(a,b,c,d,e);if("number"==typeof b)return b&=255,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):v(a,[b],c,d,e);throw new TypeError("val must be string, number or Buffer")}function v(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&(d=String(d).toLowerCase(),"ucs2"===d||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;j<h;j++)if(f(a,j)===f(b,k===-1?0:j-k)){if(k===-1&&(k=j),j-k+1===i)return k*g}else k!==-1&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;m<i;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function w(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;g<d;++g){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))return g;a[c+g]=h}return g}function x(a,b,c,d){return X(T(b,a.length-c),a,c,d)}function y(a,b,c,d){return X(U(b),a,c,d)}function z(a,b,c,d){return y(a,b,c,d)}function A(a,b,c,d){return X(W(b),a,c,d)}function B(a,b,c,d){return X(V(b,a.length-c),a,c,d)}function C(a,b,c){return 0===b&&c===a.length?Z.fromByteArray(a):Z.fromByteArray(a.slice(b,c))}function D(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(e+h<=c){var i,j,k,l;switch(h){case 1:f<128&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(l<55296||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&l<1114112&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return E(d)}function E(a){var b=a.length;if(b<=aa)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=aa));return c}function F(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function G(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function H(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;++f)e+=S(a[f]);return e}function I(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function J(a,b,c){if(a%1!==0||a<0)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function K(a,b,c,d,e,f){if(!g.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>e||b<f)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function L(a,b,c,d){b<0&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;++e)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function M(a,b,c,d){b<0&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;++e)a[c+e]=b>>>8*(d?e:3-e)&255}function N(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function O(a,b,c,d,e){return e||N(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(a,b,c,d,23,4),c+4}function P(a,b,c,d,e){return e||N(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(a,b,c,d,52,8),c+8}function Q(a){if(a=R(a).replace(ba,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function R(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function S(a){return a<16?"0"+a.toString(16):a.toString(16)}function T(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;++g){if(c=a.charCodeAt(g),c>55295&&c<57344){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function U(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function V(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function W(a){return Z.toByteArray(Q(a))}function X(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function Y(a){return a!==a}var Z=a("base64-js"),$=a("ieee754"),_=a("isarray");c.Buffer=g,c.SlowBuffer=q,c.INSPECT_MAX_BYTES=50,g.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),c.kMaxLength=e(),g.poolSize=8192,g._augment=function(a){return a.__proto__=g.prototype,a},g.from=function(a,b,c){return h(null,a,b,c)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&g[Symbol.species]===g&&Object.defineProperty(g,Symbol.species,{value:null,configurable:!0})),g.alloc=function(a,b,c){return j(null,a,b,c)},g.allocUnsafe=function(a){return k(null,a)},g.allocUnsafeSlow=function(a){return k(null,a)},g.isBuffer=function(a){return!(null==a||!a._isBuffer)},g.compare=function(a,b){if(!g.isBuffer(a)||!g.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);e<f;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:d<c?1:0},g.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(a,b){if(!_(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return g.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=g.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var f=a[c];if(!g.isBuffer(f))throw new TypeError('"list" argument must be an Array of Buffers');f.copy(d,e),e+=f.length}return d},g.byteLength=r,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<a;b+=2)t(this,b,b+1);return this},g.prototype.swap32=function(){var a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)t(this,b,b+3),t(this,b+1,b+2);return this},g.prototype.swap64=function(){var a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)t(this,b,b+7),t(this,b+1,b+6),t(this,b+2,b+5),t(this,b+3,b+4);return this},g.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?D(this,0,a):s.apply(this,arguments)},g.prototype.equals=function(a){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===g.compare(this,a)},g.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},g.prototype.compare=function(a,b,c,d,e){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),b<0||c>a.length||d<0||e>this.length)throw new RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var f=e-d,h=c-b,i=Math.min(f,h),j=this.slice(d,e),k=a.slice(b,c),l=0;l<i;++l)if(j[l]!==k[l]){f=j[l],h=k[l];break}return f<h?-1:h<f?1:0},g.prototype.includes=function(a,b,c){return this.indexOf(a,b,c)!==-1},g.prototype.indexOf=function(a,b,c){return u(this,a,b,c,!0)},g.prototype.lastIndexOf=function(a,b,c){return u(this,a,b,c,!1)},g.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(c<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return w(this,a,b,c);case"utf8":case"utf-8":return x(this,a,b,c);case"ascii":return y(this,a,b,c);case"latin1":case"binary":return z(this,a,b,c);case"base64":return A(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var aa=4096;g.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c,a<0&&(a=0)):a>c&&(a=c),b<0?(b+=c,b<0&&(b=0)):b>c&&(b=c),b<a&&(b=a);var d;if(g.TYPED_ARRAY_SUPPORT)d=this.subarray(a,b),d.__proto__=g.prototype;else{var e=b-a;d=new g(e,void 0);for(var f=0;f<e;++f)d[f]=this[f+a]}return d},g.prototype.readUIntLE=function(a,b,c){a|=0,b|=0,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},g.prototype.readUIntBE=function(a,b,c){a|=0,b|=0,c||J(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},g.prototype.readUInt8=function(a,b){return b||J(a,1,this.length),this[a]},g.prototype.readUInt16LE=function(a,b){return b||J(a,2,this.length),this[a]|this[a+1]<<8},g.prototype.readUInt16BE=function(a,b){return b||J(a,2,this.length),this[a]<<8|this[a+1]},g.prototype.readUInt32LE=function(a,b){return b||J(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},g.prototype.readUInt32BE=function(a,b){return b||J(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},g.prototype.readIntLE=function(a,b,c){a|=0,b|=0,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},g.prototype.readIntBE=function(a,b,c){a|=0,b|=0,c||J(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},g.prototype.readInt8=function(a,b){return b||J(a,1,this.length),128&this[a]?(255-this[a]+1)*-1:this[a]},g.prototype.readInt16LE=function(a,b){b||J(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt16BE=function(a,b){b||J(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt32LE=function(a,b){return b||J(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},g.prototype.readInt32BE=function(a,b){return b||J(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},g.prototype.readFloatLE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!0,23,4)},g.prototype.readFloatBE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!1,23,4)},g.prototype.readDoubleLE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!0,52,8)},g.prototype.readDoubleBE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!1,52,8)},g.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b|=0,c|=0,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=1,g=0;for(this[b]=255&a;++g<c&&(f*=256);)this[b+g]=a/f&255;return b+c},g.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b|=0,c|=0,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=c-1,g=1;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=a/g&255;return b+c},g.prototype.writeUInt8=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,1,255,0),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},g.prototype.writeUInt16LE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeUInt16BE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeUInt32LE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):M(this,a,b,!0),b+4},g.prototype.writeUInt32BE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)a<0&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)a<0&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeInt8=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,1,127,-128),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),a<0&&(a=255+a+1),this[b]=255&a,b+1},g.prototype.writeInt16LE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeInt16BE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeInt32LE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):M(this,a,b,!0),b+4},g.prototype.writeInt32BE=function(a,b,c){return a=+a,b|=0,c||K(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeFloatLE=function(a,b,c){return O(this,a,b,!0,c)},g.prototype.writeFloatBE=function(a,b,c){return O(this,a,b,!1,c)},g.prototype.writeDoubleLE=function(a,b,c){return P(this,a,b,!0,c)},g.prototype.writeDoubleBE=function(a,b,c){return P(this,a,b,!1,c)},g.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("sourceStart out of bounds");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&c<b&&b<d)for(e=f-1;e>=0;--e)a[e+b]=this[e+c];else if(f<1e3||!g.TYPED_ARRAY_SUPPORT)for(e=0;e<f;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f},g.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e=a.charCodeAt(0);e<256&&(a=e)}if(void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!g.isEncoding(d))throw new TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a&=255);if(b<0||this.length<b||this.length<c)throw new RangeError("Out of range index");if(c<=b)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var f;if("number"==typeof a)for(f=b;f<c;++f)this[f]=a;else{var h=g.isBuffer(a)?a:T(new g(a,d).toString()),i=h.length;for(f=0;f<c-b;++f)this[f+b]=h[f%i]}return this};var ba=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":60,ieee754:66,isarray:69}],64:[function(a,b,c){(function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function q(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=a.isBuffer}).call(this,{isBuffer:a("../../is-buffer/index.js")})},{"../../is-buffer/index.js":68}],65:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],66:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],67:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],68:[function(a,b,c){function d(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}function e(a){return"function"==typeof a.readFloatLE&&"function"==typeof a.slice&&d(a.slice(0,0))}b.exports=function(a){return null!=a&&(d(a)||e(a)||!!a._isBuffer)}},{}],69:[function(a,b,c){var d={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==d.call(a)}},{}],70:[function(a,b,c){(function(a){"use strict";function c(b,c,d,e){if("function"!=typeof b)throw new TypeError('"callback" argument must be a function');var f,g,h=arguments.length;switch(h){case 0:case 1:return a.nextTick(b);case 2:return a.nextTick(function(){b.call(null,c)});case 3:return a.nextTick(function(){b.call(null,c,d)});case 4:return a.nextTick(function(){b.call(null,c,d,e)});default:for(f=new Array(h-1),g=0;g<f.length;)f[g++]=arguments[g];return a.nextTick(function(){b.apply(null,f)})}}!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?b.exports=c:b.exports=a.nextTick}).call(this,a("_process"))},{_process:71}],71:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],72:[function(a,b,c){"use strict";function d(a){return this instanceof d?(j.call(this,a),k.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",e)):new d(a)}function e(){this.allowHalfOpen||this._writableState.ended||h(f,this)}function f(a){a.end()}var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};b.exports=d;var h=a("process-nextick-args"),i=a("core-util-is");i.inherits=a("inherits");var j=a("./_stream_readable"),k=a("./_stream_writable");i.inherits(d,j);for(var l=g(k.prototype),m=0;m<l.length;m++){var n=l[m];d.prototype[n]||(d.prototype[n]=k.prototype[n])}},{"./_stream_readable":74,"./_stream_writable":76,"core-util-is":64,inherits:67,"process-nextick-args":70}],73:[function(a,b,c){"use strict";function d(a){return this instanceof d?void e.call(this,a):new d(a)}b.exports=d;var e=a("./_stream_transform"),f=a("core-util-is");f.inherits=a("inherits"),f.inherits(d,e),d.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":75,"core-util-is":64,inherits:67}],74:[function(a,b,c){(function(c){"use strict";function d(a,b,c){return"function"==typeof a.prependListener?a.prependListener(b,c):void(a._events&&a._events[b]?F(a._events[b])?a._events[b].unshift(c):a._events[b]=[c,a._events[b]]:a.on(b,c))}function e(b,c){D=D||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof D&&(this.objectMode=this.objectMode||!!b.readableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(N||(N=a("string_decoder/").StringDecoder),this.decoder=new N(b.encoding),this.encoding=b.encoding)}function f(b){return D=D||a("./_stream_duplex"),this instanceof f?(this._readableState=new e(b,this),this.readable=!0,b&&"function"==typeof b.read&&(this._read=b.read),void G.call(this)):new f(b)}function g(a,b,c,d,e){var f=k(b,c);if(f)a.emit("error",f);else if(null===c)b.reading=!1,l(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var g=new Error("stream.push() after EOF");a.emit("error",g)}else if(b.endEmitted&&e){var i=new Error("stream.unshift() after end event");a.emit("error",i)}else{var j;!b.decoder||e||d||(c=b.decoder.write(c),j=!b.objectMode&&0===c.length),e||(b.reading=!1),j||(b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&m(a))),o(a,b)}else e||(b.reading=!1);return h(b)}function h(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function i(a){return a>=P?a=P:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function j(a,b){return a<=0||0===b.length&&b.ended?0:b.objectMode?1:a!==a?b.flowing&&b.length?b.buffer.head.data.length:b.length:(a>b.highWaterMark&&(b.highWaterMark=i(a)),a<=b.length?a:b.ended?b.length:(b.needReadable=!0,0))}function k(a,b){var c=null;return I.isBuffer(b)||"string"==typeof b||null===b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function l(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,m(a)}}function m(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(M("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?E(n,a):n(a))}function n(a){M("emit readable"),a.emit("readable"),u(a)}function o(a,b){b.readingMore||(b.readingMore=!0,E(p,a,b))}function p(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(M("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function q(a){return function(){var b=a._readableState;M("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&H(a,"data")&&(b.flowing=!0,u(a))}}function r(a){M("readable nexttick read 0"),a.read(0)}function s(a,b){b.resumeScheduled||(b.resumeScheduled=!0,E(t,a,b))}function t(a,b){b.reading||(M("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),u(a),b.flowing&&!b.reading&&a.read(0)}function u(a){var b=a._readableState;for(M("flow",b.flowing);b.flowing&&null!==a.read(););}function v(a,b){if(0===b.length)return null;var c;return b.objectMode?c=b.buffer.shift():!a||a>=b.length?(c=b.decoder?b.buffer.join(""):1===b.buffer.length?b.buffer.head.data:b.buffer.concat(b.length),b.buffer.clear()):c=w(a,b.buffer,b.decoder),c}function w(a,b,c){var d;return a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):d=a===b.head.data.length?b.shift():c?x(a,b):y(a,b),d}function x(a,b){var c=b.head,d=1,e=c.data;for(a-=e.length;c=c.next;){var f=c.data,g=a>f.length?f.length:a;if(e+=g===f.length?f:f.slice(0,a),a-=g,0===a){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}return b.length-=d,e}function y(a,b){var c=J.allocUnsafe(a),d=b.head,e=1;for(d.data.copy(c),a-=d.data.length;d=d.next;){var f=d.data,g=a>f.length?f.length:a;if(f.copy(c,c.length-a,0,g),a-=g,0===a){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}return b.length-=e,c}function z(a){var b=a._readableState;if(b.length>0)throw new Error('"endReadable()" called on non-empty stream');b.endEmitted||(b.ended=!0,E(A,b,a))}function A(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function B(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)}function C(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}b.exports=f;var D,E=a("process-nextick-args"),F=a("isarray");f.ReadableState=e;var G,H=(a("events").EventEmitter,function(a,b){return a.listeners(b).length});!function(){try{G=a("stream")}catch(a){}finally{G||(G=a("events").EventEmitter)}}();var I=a("buffer").Buffer,J=a("buffer-shims"),K=a("core-util-is");K.inherits=a("inherits");var L=a("util"),M=void 0;M=L&&L.debuglog?L.debuglog("stream"):function(){};var N,O=a("./internal/streams/BufferList");K.inherits(f,G),f.prototype.push=function(a,b){var c=this._readableState;return c.objectMode||"string"!=typeof a||(b=b||c.defaultEncoding,b!==c.encoding&&(a=J.from(a,b),b="")),g(this,c,a,b,!1)},f.prototype.unshift=function(a){var b=this._readableState;return g(this,b,a,"",!0)},f.prototype.isPaused=function(){return this._readableState.flowing===!1},f.prototype.setEncoding=function(b){return N||(N=a("string_decoder/").StringDecoder),this._readableState.decoder=new N(b),this._readableState.encoding=b,this};var P=8388608;f.prototype.read=function(a){
M("read",a),a=parseInt(a,10);var b=this._readableState,c=a;if(0!==a&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return M("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?z(this):m(this),null;if(a=j(a,b),0===a&&b.ended)return 0===b.length&&z(this),null;var d=b.needReadable;M("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,M("length less than watermark",d)),b.ended||b.reading?(d=!1,M("reading or ended",d)):d&&(M("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=j(c,b)));var e;return e=a>0?v(a,b):null,null===e?(b.needReadable=!0,a=0):b.length-=a,0===b.length&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&z(this)),null!==e&&this.emit("data",e),e},f.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))},f.prototype.pipe=function(a,b){function e(a){M("onunpipe"),a===m&&g()}function f(){M("onend"),a.end()}function g(){M("cleanup"),a.removeListener("close",j),a.removeListener("finish",k),a.removeListener("drain",r),a.removeListener("error",i),a.removeListener("unpipe",e),m.removeListener("end",f),m.removeListener("end",g),m.removeListener("data",h),s=!0,!n.awaitDrain||a._writableState&&!a._writableState.needDrain||r()}function h(b){M("ondata"),t=!1;var c=a.write(b);!1!==c||t||((1===n.pipesCount&&n.pipes===a||n.pipesCount>1&&C(n.pipes,a)!==-1)&&!s&&(M("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,t=!0),m.pause())}function i(b){M("onerror",b),l(),a.removeListener("error",i),0===H(a,"error")&&a.emit("error",b)}function j(){a.removeListener("finish",k),l()}function k(){M("onfinish"),a.removeListener("close",j),l()}function l(){M("unpipe"),m.unpipe(a)}var m=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=a;break;case 1:n.pipes=[n.pipes,a];break;default:n.pipes.push(a)}n.pipesCount+=1,M("pipe count=%d opts=%j",n.pipesCount,b);var o=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,p=o?f:g;n.endEmitted?E(p):m.once("end",p),a.on("unpipe",e);var r=q(m);a.on("drain",r);var s=!1,t=!1;return m.on("data",h),d(a,"error",i),a.once("close",j),a.once("finish",k),a.emit("pipe",m),n.flowing||(M("pipe resume"),m.resume()),a},f.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;e<d;e++)c[e].emit("unpipe",this);return this}var f=C(b.pipes,a);return f===-1?this:(b.pipes.splice(f,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},f.prototype.on=function(a,b){var c=G.prototype.on.call(this,a,b);if("data"===a)this._readableState.flowing!==!1&&this.resume();else if("readable"===a){var d=this._readableState;d.endEmitted||d.readableListening||(d.readableListening=d.needReadable=!0,d.emittedReadable=!1,d.reading?d.length&&m(this,d):E(r,this))}return c},f.prototype.addListener=f.prototype.on,f.prototype.resume=function(){var a=this._readableState;return a.flowing||(M("resume"),a.flowing=!0,s(this,a)),this},f.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this},f.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(M("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(M("wrapped data"),b.decoder&&(e=b.decoder.write(e)),(!b.objectMode||null!==e&&void 0!==e)&&(b.objectMode||e&&e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return B(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){M("wrapped _read",b),c&&(c=!1,a.resume())},d},f._fromList=v}).call(this,a("_process"))},{"./_stream_duplex":72,"./internal/streams/BufferList":77,_process:71,buffer:63,"buffer-shims":62,"core-util-is":64,events:65,inherits:67,isarray:69,"process-nextick-args":70,"string_decoder/":80,util:61}],75:[function(a,b,c){"use strict";function d(a){this.afterTransform=function(b,c){return e(a,b,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function e(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,null!==c&&void 0!==c&&a.push(c),e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function f(a){if(!(this instanceof f))return new f(a);h.call(this,a),this._transformState=new d(this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,a&&("function"==typeof a.transform&&(this._transform=a.transform),"function"==typeof a.flush&&(this._flush=a.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(a,c){g(b,a,c)}):g(b)})}function g(a,b,c){if(b)return a.emit("error",b);null!==c&&void 0!==c&&a.push(c);var d=a._writableState,e=a._transformState;if(d.length)throw new Error("Calling transform done when ws.length != 0");if(e.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}b.exports=f;var h=a("./_stream_duplex"),i=a("core-util-is");i.inherits=a("inherits"),i.inherits(f,h),f.prototype.push=function(a,b){return this._transformState.needTransform=!1,h.prototype.push.call(this,a,b)},f.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")},f.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},f.prototype._read=function(a){var b=this._transformState;null!==b.writechunk&&b.writecb&&!b.transforming?(b.transforming=!0,this._transform(b.writechunk,b.writeencoding,b.afterTransform)):b.needTransform=!0}},{"./_stream_duplex":72,"core-util-is":64,inherits:67}],76:[function(a,b,c){(function(c){"use strict";function d(){}function e(a,b,c){this.chunk=a,this.encoding=b,this.callback=c,this.next=null}function f(b,c){x=x||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof x&&(this.objectMode=this.objectMode||!!b.writableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var f=b.decodeStrings===!1;this.decodeStrings=!f,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){o(c,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function g(b){return x=x||a("./_stream_duplex"),F.call(g,this)||this instanceof x?(this._writableState=new f(b,this),this.writable=!0,b&&("function"==typeof b.write&&(this._write=b.write),"function"==typeof b.writev&&(this._writev=b.writev)),void B.call(this)):new g(b)}function h(a,b){var c=new Error("write after end");a.emit("error",c),y(b,c)}function i(a,b,c,d){var e=!0,f=!1;return null===c?f=new TypeError("May not write null values to stream"):D.isBuffer(c)||"string"==typeof c||void 0===c||b.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(a.emit("error",f),y(d,f),e=!1),e}function j(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=E.from(b,c)),b}function k(a,b,c,d,f){c=j(b,c,d),D.isBuffer(c)&&(d="buffer");var g=b.objectMode?1:c.length;b.length+=g;var h=b.length<b.highWaterMark;if(h||(b.needDrain=!0),b.writing||b.corked){var i=b.lastBufferedRequest;b.lastBufferedRequest=new e(c,d,f),i?i.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else l(a,b,!1,g,c,d,f);return h}function l(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function m(a,b,c,d,e){--b.pendingcb,c?y(e,d):e(d),a._writableState.errorEmitted=!0,a.emit("error",d)}function n(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function o(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(n(c),b)m(a,c,d,b,e);else{var f=s(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||r(a,c),d?z(p,a,c,f,e):p(a,c,f,e)}}function p(a,b,c,d){c||q(a,b),b.pendingcb--,d(),u(a,b)}function q(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function r(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,e=new Array(d),f=b.corkedRequestsFree;f.entry=c;for(var g=0;c;)e[g]=c,c=c.next,g+=1;l(a,b,!0,b.length,e,"",f.finish),b.pendingcb++,b.lastBufferedRequest=null,f.next?(b.corkedRequestsFree=f.next,f.next=null):b.corkedRequestsFree=new w(b)}else{for(;c;){var h=c.chunk,i=c.encoding,j=c.callback,k=b.objectMode?1:h.length;if(l(a,b,!1,k,h,i,j),c=c.next,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequestCount=0,b.bufferedRequest=c,b.bufferProcessing=!1}function s(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function t(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function u(a,b){var c=s(b);return c&&(0===b.pendingcb?(t(a,b),b.finished=!0,a.emit("finish")):t(a,b)),c}function v(a,b,c){b.ending=!0,u(a,b),c&&(b.finished?y(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function w(a){var b=this;this.next=null,this.entry=null,this.finish=function(c){var d=b.entry;for(b.entry=null;d;){var e=d.callback;a.pendingcb--,e(c),d=d.next}a.corkedRequestsFree?a.corkedRequestsFree.next=b:a.corkedRequestsFree=b}}b.exports=g;var x,y=a("process-nextick-args"),z=!c.browser&&["v0.10","v0.9."].indexOf(c.version.slice(0,5))>-1?setImmediate:y;g.WritableState=f;var A=a("core-util-is");A.inherits=a("inherits");var B,C={deprecate:a("util-deprecate")};!function(){try{B=a("stream")}catch(a){}finally{B||(B=a("events").EventEmitter)}}();var D=a("buffer").Buffer,E=a("buffer-shims");A.inherits(g,B),f.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(f.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(a){}}();var F;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(F=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(a){return!!F.call(this,a)||a&&a._writableState instanceof f}})):F=function(a){return a instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(a,b,c){var e=this._writableState,f=!1;return"function"==typeof b&&(c=b,b=null),D.isBuffer(a)?b="buffer":b||(b=e.defaultEncoding),"function"!=typeof c&&(c=d),e.ended?h(this,c):i(this,e,a,c)&&(e.pendingcb++,f=k(this,e,a,b,c)),f},g.prototype.cork=function(){var a=this._writableState;a.corked++},g.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||r(this,a))},g.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);return this._writableState.defaultEncoding=a,this},g.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||v(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":72,_process:71,buffer:63,"buffer-shims":62,"core-util-is":64,events:65,inherits:67,"process-nextick-args":70,"util-deprecate":82}],77:[function(a,b,c){"use strict";function d(){this.head=null,this.tail=null,this.length=0}var e=(a("buffer").Buffer,a("buffer-shims"));b.exports=d,d.prototype.push=function(a){var b={data:a,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length},d.prototype.unshift=function(a){var b={data:a,next:this.head};0===this.length&&(this.tail=b),this.head=b,++this.length},d.prototype.shift=function(){if(0!==this.length){var a=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,a}},d.prototype.clear=function(){this.head=this.tail=null,this.length=0},d.prototype.join=function(a){if(0===this.length)return"";for(var b=this.head,c=""+b.data;b=b.next;)c+=a+b.data;return c},d.prototype.concat=function(a){if(0===this.length)return e.alloc(0);if(1===this.length)return this.head.data;for(var b=e.allocUnsafe(a>>>0),c=this.head,d=0;c;)c.data.copy(b,d),d+=c.data.length,c=c.next;return b}},{buffer:63,"buffer-shims":62}],78:[function(a,b,c){(function(d){var e=function(){try{return a("stream")}catch(a){}}();c=b.exports=a("./lib/_stream_readable.js"),c.Stream=e||c,c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js"),!d.browser&&"disable"===d.env.READABLE_STREAM&&e&&(b.exports=e)}).call(this,a("_process"))},{"./lib/_stream_duplex.js":72,"./lib/_stream_passthrough.js":73,"./lib/_stream_readable.js":74,"./lib/_stream_transform.js":75,"./lib/_stream_writable.js":76,_process:71}],79:[function(a,b,c){b.exports=a("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":75}],80:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&d<=56319)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&d<=56319){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(b<=2&&c>>4==14){this.charLength=3;break}if(b<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:63}],81:[function(a,b,c){(function(c){function d(a){g.call(this,a),this._destroyed=!1}function e(a,b,c){c(null,a)}function f(a){return function(b,c,d){return"function"==typeof b&&(d=c,c=b,b={}),"function"!=typeof c&&(c=e),"function"!=typeof d&&(d=null),a(b,c,d)}}var g=a("readable-stream/transform"),h=a("util").inherits,i=a("xtend");h(d,g),d.prototype.destroy=function(a){if(!this._destroyed){this._destroyed=!0;var b=this;c.nextTick(function(){a&&b.emit("error",a),b.emit("close")})}},b.exports=f(function(a,b,c){var e=new d(a);return e._transform=b,c&&(e._flush=c),e}),b.exports.ctor=f(function(a,b,c){function e(b){return this instanceof e?(this.options=i(a,b),void d.call(this,this.options)):new e(b)}return h(e,d),e.prototype._transform=b,c&&(e.prototype._flush=c),e}),b.exports.obj=f(function(a,b,c){var e=new d(i({objectMode:!0,highWaterMark:16},a));return e._transform=b,c&&(e._flush=c),e})}).call(this,a("_process"))},{_process:71,"readable-stream/transform":79,util:85,xtend:91}],82:[function(a,b,c){(function(a){function c(a,b){function c(){if(!e){if(d("throwDeprecation"))throw new Error(b);d("traceDeprecation")?console.trace(b):console.warn(b),e=!0}return a.apply(this,arguments)}if(d("noDeprecation"))return a;var e=!1;return c}function d(b){try{if(!a.localStorage)return!1}catch(a){return!1}var c=a.localStorage[b];return null!=c&&"true"===String(c).toLowerCase()}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],83:[function(a,b,c){arguments[4][67][0].apply(c,arguments)},{dup:67}],84:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],85:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":84,_process:71,inherits:83}],86:[function(a,b,c){var d=a("./v1"),e=a("./v4"),f=e;f.v1=d,f.v4=e,b.exports=f},{"./v1":89,"./v4":90}],87:[function(a,b,c){function d(a,b){var c=b||0,d=e;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}for(var e=[],f=0;f<256;++f)e[f]=(f+256).toString(16).substr(1);b.exports=d},{}],88:[function(a,b,c){(function(a){var c,d=a.crypto||a.msCrypto;if(d&&d.getRandomValues){var e=new Uint8Array(16);c=function(){return d.getRandomValues(e),e}}if(!c){var f=new Array(16);c=function(){for(var a,b=0;b<16;b++)0===(3&b)&&(a=4294967296*Math.random()),f[b]=a>>>((3&b)<<3)&255;return f}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],89:[function(a,b,c){function d(a,b,c){var d=b&&c||0,e=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:i,l=void 0!==a.msecs?a.msecs:(new Date).getTime(),m=void 0!==a.nsecs?a.nsecs:k+1,n=l-j+(m-k)/1e4;if(n<0&&void 0===a.clockseq&&(g=g+1&16383),(n<0||l>j)&&void 0===a.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");j=l,k=m,i=g,l+=122192928e5;var o=(1e4*(268435455&l)+m)%4294967296;e[d++]=o>>>24&255,e[d++]=o>>>16&255,e[d++]=o>>>8&255,e[d++]=255&o;var p=l/4294967296*1e4&268435455;e[d++]=p>>>8&255,e[d++]=255&p,e[d++]=p>>>24&15|16,e[d++]=p>>>16&255,e[d++]=g>>>8|128,e[d++]=255&g;for(var q=a.node||h,r=0;r<6;++r)e[d+r]=q[r];return b?b:f(e)}var e=a("./lib/rng"),f=a("./lib/bytesToUuid"),g=e(),h=[1|g[0],g[1],g[2],g[3],g[4],g[5]],i=16383&(g[6]<<8|g[7]),j=0,k=0;b.exports=d},{"./lib/bytesToUuid":87,"./lib/rng":88}],90:[function(a,b,c){function d(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[d+h]=g[h];return b||f(g)}var e=a("./lib/rng"),f=a("./lib/bytesToUuid");b.exports=d},{"./lib/bytesToUuid":87,"./lib/rng":88}],91:[function(a,b,c){function d(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c)e.call(c,d)&&(a[d]=c[d])}return a}b.exports=d;var e=Object.prototype.hasOwnProperty},{}]},{},[18]);